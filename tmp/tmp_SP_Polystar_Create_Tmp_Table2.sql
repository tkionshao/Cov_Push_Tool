CREATE DEFINER=`covmo`@`%` PROCEDURE `SP_Polystar_Create_Tmp_Table2`(IN TECH_MASK TINYINT(2),IN GT_DB VARCHAR(50),IN gt_polystar_db VARCHAR (20),IN RPT_TYPE VARCHAR(20),IMSI_GID TINYINT(2) )
BEGIN
	DECLARE START_TIME DATETIME DEFAULT SYSDATE();
	DECLARE RNC_ID INT;
	DECLARE DATA_DATE VARCHAR(8);
	DECLARE DATA_QRT VARCHAR(4);
	DECLARE DATA_HOUR VARCHAR(4);
	DECLARE FOLDER_PATH VARCHAR(20);
	DECLARE DAILY_DB VARCHAR(25);
	DECLARE SH_EH VARCHAR(9) DEFAULT RIGHT(GT_DB,9);
	DECLARE CURRENT_NT_DB VARCHAR(50) DEFAULT CONCAT('gt_nt_',gt_strtok(GT_DB,3,'_'));
	DECLARE v_group_table_name VARCHAR(100) DEFAULT '';
	
		
	DECLARE TABLE_POS_POLYSTAR_COL_STR VARCHAR(9000) DEFAULT 
		'
		PU_ID MEDIUMINT(9) DEFAULT NULL,
		CALL_ID BIGINT(20)  DEFAULT NULL,
		DATE_TIME DATETIME(3)  DEFAULT NULL,		
		IMSI CHAR(16)  DEFAULT NULL,
		IMEI CHAR(16)  DEFAULT NULL,
		IMSI_GROUP_ID MEDIUMINT(9) DEFAULT NULL,
		RAN_ID MEDIUMINT(9) DEFAULT NULL,	
		NODEB_ID VARCHAR(20) DEFAULT NULL,
		CELL_ID MEDIUMINT(9)  DEFAULT NULL,
		CELL_NAME VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT '''',
		CALL_TYPE TINYINT(4)  DEFAULT NULL,
		CALL_STATUS TINYINT(4)  DEFAULT NULL,
		MCC CHAR(3)  DEFAULT NULL,
		MNC VARCHAR(3)  DEFAULT NULL,
		MAKE_ID SMALLINT(6)  DEFAULT NULL,
		MODEL_ID MEDIUMINT(9)  DEFAULT NULL,	
		FREQUENCY_BAND SMALLINT(6)  DEFAULT NULL,
		ARFCN MEDIUMINT(9)  DEFAULT NULL,		
		MOVING TINYINT(4)  DEFAULT NULL,
		INDOOR TINYINT(4)  DEFAULT NULL,	
		SIG_LEV FLOAT  DEFAULT NULL,
		SIG_QUAL FLOAT  DEFAULT NULL,
		LOC_ID BIGINT(20) DEFAULT NULL,
		TILE_ID BIGINT(20) DEFAULT NULL,
		DATA_DATE DATE DEFAULT NULL,
		DATA_HOUR TINYINT(4)  DEFAULT NULL,
	
		UL_START BIGINT(20) DEFAULT NULL,
		UL_END BIGINT(20) DEFAULT NULL,
		DL_START BIGINT(20) DEFAULT NULL,
		DL_END BIGINT(20) DEFAULT NULL,
		LAC MEDIUMINT(9) DEFAULT NULL,
		RAC MEDIUMINT(9) DEFAULT NULL,
		CID MEDIUMINT(9) DEFAULT NULL,
		ECI INT(11) DEFAULT NULL,
		HTTPHOST VARCHAR(50) DEFAULT NULL,
		HTTPUSERAGENT VARCHAR(150) DEFAULT NULL,
		APPLICATION MEDIUMINT(9) DEFAULT NULL,
		APPLICATIONFAMILY MEDIUMINT(9) DEFAULT NULL,
		APPLICATION_STACK VARCHAR(50) DEFAULT NULL,
		UL_BYTES MEDIUMINT(9) DEFAULT NULL,
		DL_BYTES MEDIUMINT(9) DEFAULT NULL,
		TCP_RTT_UL MEDIUMINT(9) DEFAULT NULL,
		TCP_RTT_DL MEDIUMINT(9) DEFAULT NULL
	';
	
	DECLARE RPT_COL_STR VARCHAR(2000) DEFAULT 
		'
		UL_SERVICE_CNT INT(11) DEFAULT NULL,
		DL_SERVICE_CNT INT(11) DEFAULT NULL,
		SIG_LEV_SUM DOUBLE DEFAULT NULL,
		SIG_LEV_CNT INT(11) DEFAULT NULL,	
		SIG_QUAL_SUM DOUBLE DEFAULT NULL,
		SIG_QUAL_CNT INT(11) DEFAULT NULL,
		
		UL_DURATION INT(11) DEFAULT NULL,
		DL_DURATION INT(11) DEFAULT NULL,
		UL_BYTES INT(11) DEFAULT NULL,
		DL_BYTES INT(11) DEFAULT NULL,	
		TCP_RTT_UL INT(11) DEFAULT NULL,
		TCP_RTT_DL BIGINT(20) DEFAULT NULL,
		MAX_UL_THROUGHPUT FLOAT DEFAULT NULL,	
		MAX_DL_THROUGHTPUT FLOAT DEFAULT NULL,
		SUBSCIRBER_CNT_HLL VARCHAR(5000) DEFAULT NULL';
	
	DECLARE CELL_TILE_HR_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		`DATA_DATE` DATE NOT NULL,
		`DATA_HOUR` TINYINT(4) NOT NULL, 
		`CALL_TYPE` TINYINT(4) NOT NULL,
		`CALL_STATUS` TINYINT(4) NOT NULL,					  					 
		`MOVING` TINYINT(4) NOT NULL,
		`INDOOR` TINYINT(4) NOT NULL,
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',
		`TILE_ID` bigint(20) NOT NULL ,
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`CELL_ID` MEDIUMINT(9)  NOT NULL DEFAULT ''0'',
		`CELL_NAME` VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''
	';
	
	
	DECLARE CELL_TILE_DEF_HR_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		`DATA_DATE` DATE NOT NULL,
		`DATA_HOUR` TINYINT(4) NOT NULL, 		
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',
		`TILE_ID` bigint(20) NOT NULL ,
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`CELL_ID` MEDIUMINT(9)  NOT NULL DEFAULT ''0'',
		`CELL_NAME` VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''		
	';
	DECLARE CELL_HR_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		`DATA_DATE` DATE NOT NULL,
		`DATA_HOUR` TINYINT(4) NOT NULL, 
		`CALL_TYPE` TINYINT(4) NOT NULL,
		`CALL_STATUS` TINYINT(4) NOT NULL,					  					 
		`MOVING` TINYINT(4) NOT NULL,
		`INDOOR` TINYINT(4) NOT NULL,
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`CELL_ID` MEDIUMINT(9)  NOT NULL DEFAULT ''0'',
		`CELL_NAME` VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''
	';
	DECLARE TILE_HR_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		`DATA_DATE` DATE NOT NULL,
		`DATA_HOUR` TINYINT(4) NOT NULL, 
		`CALL_TYPE` TINYINT(4) NOT NULL,
		`CALL_STATUS` TINYINT(4) NOT NULL,					  					 
		`MOVING` TINYINT(4) NOT NULL,
		`INDOOR` TINYINT(4) NOT NULL,
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',	
		`TILE_ID` bigint(20) NOT NULL ,
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0''
	';
	DECLARE CELL_DEF_HR_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		`DATA_DATE` DATE NOT NULL,
		`DATA_HOUR` TINYINT(4) NOT NULL, 		
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',		
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`CELL_ID` MEDIUMINT(9)  NOT NULL DEFAULT ''0'',
		`CELL_NAME` VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''	
	';
	DECLARE TILE_DEF_HR_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		DATA_DATE DATE NOT NULL,
		DATA_HOUR TINYINT(4) NOT NULL,	
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		TILE_ID BIGINT(20) NOT NULL,
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0''
	';
	DECLARE CELL_DY_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		`DATA_DATE` DATE NOT NULL,
		`CALL_TYPE` TINYINT(4) NOT NULL,
		`CALL_STATUS` TINYINT(4) NOT NULL,					  					 
		`MOVING` TINYINT(4) NOT NULL,
		`INDOOR` TINYINT(4) NOT NULL,
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`CELL_ID` MEDIUMINT(9)  NOT NULL DEFAULT ''0'',
		`CELL_NAME` VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''
	';
	DECLARE CELL_TILE_DY_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		`DATA_DATE` DATE NOT NULL,
		`CALL_TYPE` TINYINT(4) NOT NULL,
		`CALL_STATUS` TINYINT(4) NOT NULL,					  					 
		`MOVING` TINYINT(4) NOT NULL,
		`INDOOR` TINYINT(4) NOT NULL,
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',
		`TILE_ID` bigint(20) NOT NULL ,
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`CELL_ID` MEDIUMINT(9)  NOT NULL DEFAULT ''0'',
		`CELL_NAME` VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''
	';
	DECLARE CELL_TILE_DY_DEF_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		`DATA_DATE` DATE NOT NULL,		
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',
		`TILE_ID` bigint(20) NOT NULL ,
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`CELL_ID` MEDIUMINT(9)  NOT NULL DEFAULT ''0'',
		`CELL_NAME` VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''
	';
	DECLARE TILE_DY_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		`DATA_DATE` DATE NOT NULL,
		`CALL_TYPE` TINYINT(4) NOT NULL,
		`CALL_STATUS` TINYINT(4) NOT NULL,					  					 
		`MOVING` TINYINT(4) NOT NULL,
		`INDOOR` TINYINT(4) NOT NULL,
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',	
		`TILE_ID` bigint(20) NOT NULL ,
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0''
	';
	DECLARE CELL_DY_DEF_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		`DATA_DATE` DATE NOT NULL,		
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',	
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`CELL_ID` MEDIUMINT(9)  NOT NULL DEFAULT ''0'',
		`CELL_NAME` VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''		
	';
	DECLARE TILE_DY_DEF_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		DATA_DATE DATE NOT NULL,
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		TILE_ID BIGINT(20) NOT NULL,
		RAN_ID MEDIUMINT(9) NOT NULL DEFAULT ''0''
	';	
	
	DECLARE CELL_WK_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'	
		`CALL_TYPE` TINYINT(4) NOT NULL,
		`CALL_STATUS` TINYINT(4) NOT NULL,					  					 
		`MOVING` TINYINT(4) NOT NULL,
		`INDOOR` TINYINT(4) NOT NULL,
		`FREQUENCY_BAND` SMALLINT(6) NOT NULL DEFAULT ''0'',		
		`ARFCN` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',	
		`RAN_ID` MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		`CELL_ID` MEDIUMINT(9)  NOT NULL DEFAULT ''0'',
		`CELL_NAME` VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''
	';	
	
	DECLARE CELL_WK_DEF_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		FREQUENCY_BAND SMALLINT(6) NOT NULL DEFAULT ''0'',
		ARFCN MEDIUMINT(9) NOT NULL DEFAULT ''0'',		
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',
		RAN_ID MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		CELL_ID MEDIUMINT(9) NOT NULL   DEFAULT ''0'',
		CELL_NAME VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''
	';
	
	DECLARE CELL_TILE_WK_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		CALL_TYPE TINYINT(4) NOT NULL,	
		CALL_STATUS TINYINT(4) NOT NULL,
		MOVING TINYINT(4) NOT NULL,
		INDOOR TINYINT(4) NOT NULL,
		FREQUENCY_BAND SMALLINT(6) NOT NULL ,
		ARFCN MEDIUMINT(9) NOT NULL,
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',	
		TILE_ID BIGINT(20) NOT NULL,
		RAN_ID MEDIUMINT(9) NOT NULL DEFAULT ''0'',		
		CELL_ID MEDIUMINT(9)  NOT NULL,
		CELL_NAME VARCHAR(50) CHARACTER SET utf8 NOT NULL
	';
	DECLARE CELL_TILE_WK_DEF_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		FREQUENCY_BAND SMALLINT(6) NOT NULL ,
		ARFCN MEDIUMINT(9) NOT NULL,
		`NODEB_ID` VARCHAR(20) NOT NULL DEFAULT ''0'',
		TILE_ID BIGINT(20) NOT NULL,
		RAN_ID MEDIUMINT(9) NOT NULL DEFAULT ''0'',
		CELL_ID MEDIUMINT(9)  NOT NULL,
		CELL_NAME VARCHAR(50) CHARACTER SET utf8 NOT NULL DEFAULT ''''
	';
	DECLARE TILE_WK_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		CALL_TYPE TINYINT(4) NOT NULL,
		CALL_STATUS TINYINT(4) NOT NULL,
		MOVING TINYINT(4) NOT NULL,
		INDOOR TINYINT(4) NOT NULL,
		FREQUENCY_BAND SMALLINT(6) NOT NULL,
		ARFCN MEDIUMINT(9) NOT NULL,
		TILE_ID BIGINT(20) NOT NULL,
		RAN_ID MEDIUMINT(9) NOT NULL DEFAULT ''0''
	';
	
	DECLARE TILE_WK_DEF_KEY_COL_STR VARCHAR(1000) DEFAULT 
		'
		FREQUENCY_BAND SMALLINT(6) NOT NULL,
		ARFCN MEDIUMINT(9) NOT NULL,
		TILE_ID BIGINT(20) NOT NULL,
		RAN_ID MEDIUMINT(9) NOT NULL DEFAULT ''0''
	';
	
	DECLARE TILE_ZOOM_COL_STR VARCHAR(1000) DEFAULT 
		'
		FREQUENCY_BAND SMALLINT(6) NOT NULL,
		ARFCN MEDIUMINT(9) NOT NULL,
		TILE_ID BIGINT(20) NOT NULL,
		REG_1_ID bigint(20) DEFAULT NULL,
		REG_2_ID bigint(20) DEFAULT NULL,
		REG_3_ID bigint(20) DEFAULT NULL
	';
	DECLARE TILE_REG_COL_STR VARCHAR(1000) DEFAULT 
		'
		FREQUENCY_BAND SMALLINT(6) NOT NULL,
		ARFCN MEDIUMINT(9) NOT NULL,
		REG_ID BIGINT(20) NOT NULL DEFAULT ''0''
		
	';
	
	DECLARE RPT_XDR_COL_STR VARCHAR(2000) DEFAULT 
		'
		ul_numberOfFlow INT(11) DEFAULT NULL,
		ul_numberOfPackets INT(11) DEFAULT NULL,
		ul_numberOfBytes INT(11) DEFAULT NULL,
		dl_numberOfFlow INT(11) DEFAULT NULL,	
		dl_numberOfPackets INT(11) DEFAULT NULL,
		dl_numberOfBytes INT(11) DEFAULT NULL,
		SUBSCIRBER_CNT_HLL VARCHAR(5000) DEFAULT NULL
	';
	
	DECLARE RPT_XDR_TOP_COL_STR VARCHAR(2000) DEFAULT 
		'
		ul_numberOfFlow INT(11) DEFAULT NULL,
		ul_numberOfPackets INT(11) DEFAULT NULL,
		ul_numberOfBytes INT(11) DEFAULT NULL,
		dl_numberOfFlow INT(11) DEFAULT NULL,	
		dl_numberOfPackets INT(11) DEFAULT NULL,
		dl_numberOfBytes INT(11) DEFAULT NULL
	';
	
	SET SESSION group_concat_max_len = 100000000;
		
 	SELECT gt_strtok(GT_DB,2,'_') INTO RNC_ID;
 	SELECT gt_strtok(GT_DB,3,'_') INTO DATA_DATE;
 	SELECT gt_strtok(GT_DB,4,'_') INTO DATA_QRT;
	SELECT LEFT(DATA_QRT,2) INTO DATA_HOUR;
	
	INSERT INTO gt_gw_main.sp_log VALUES('gt_gw_main','SP_Polystar_Create_Tmp_Table2','START TO CREATE TMP TABLES',NOW());	
	
	IF TECH_MASK=4 AND RPT_TYPE = '2' THEN 
	
		-- XDR HR LTE	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_apn_lte_hr_',DATA_DATE,'_',DATA_HOUR,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_apn_lte_hr_',DATA_DATE,'_',DATA_HOUR,'` (	
							`DATA_DATE` DATE NOT NULL,
							`DATA_HOUR` TINYINT(4) NOT NULL,
							`APN`VARCHAR(50)
							,',RPT_XDR_COL_STR,'
						        ,PRIMARY KEY(`DATA_DATE`,`DATA_HOUR`,`APN`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_appfamily_lte_hr_',DATA_DATE,'_',DATA_HOUR,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;				
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_appfamily_lte_hr_',DATA_DATE,'_',DATA_HOUR,'` (	
							`DATA_DATE` DATE NOT NULL,
							`DATA_HOUR` TINYINT(4) NOT NULL,
							`applicationFamily_id` SMALLINT(6)
							,',RPT_XDR_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`DATA_HOUR`,`applicationFamily_id`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_apptype_lte_hr_',DATA_DATE,'_',DATA_HOUR,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_apptype_lte_hr_',DATA_DATE,'_',DATA_HOUR,'` (	
							`DATA_DATE` DATE NOT NULL,
							`DATA_HOUR` TINYINT(4) NOT NULL,
							`applicationStack_id` SMALLINT(6)
							,',RPT_XDR_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`DATA_HOUR`,`applicationStack_id`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_top_apptype_lte_hr_',DATA_DATE,'_',DATA_HOUR,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_top_apptype_lte_hr_',DATA_DATE,'_',DATA_HOUR,'` (	
							`DATA_DATE` DATE NOT NULL,
							`DATA_HOUR` TINYINT(4) NOT NULL,
							`applicationStack_id` SMALLINT(6),
							`IMSI` VARCHAR(16),
							`IMEI` VARCHAR(16)
							,',RPT_XDR_TOP_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`DATA_HOUR`,`applicationStack_id`,`IMSI`,`IMEI`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_top_sub_lte_hr_',DATA_DATE,'_',DATA_HOUR,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_top_sub_lte_hr_',DATA_DATE,'_',DATA_HOUR,'` (	
							`DATA_DATE` DATE NOT NULL,
							`DATA_HOUR` TINYINT(4) NOT NULL,						
							`IMSI` VARCHAR(16),
							`IMEI` VARCHAR(16)
							,',RPT_XDR_TOP_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`DATA_HOUR`,`IMSI`,`IMEI`)
						,KEY `IX_TIME_IMSI` (`DATA_DATE`,`DATA_HOUR`,`IMSI`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
	
	END IF;
	
	IF TECH_MASK=4 AND RPT_TYPE = '3' THEN 
	
	-- XDR DY LTE
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_apn_lte_dy_',DATA_DATE,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_apn_lte_dy_',DATA_DATE,'` (	
							`DATA_DATE` DATE NOT NULL,							
							`APN`VARCHAR(50)
							,',RPT_XDR_COL_STR,'
						        ,PRIMARY KEY(`DATA_DATE`,`APN`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_appfamily_lte_dy_',DATA_DATE,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_appfamily_lte_dy_',DATA_DATE,'` (	
							`DATA_DATE` DATE NOT NULL,							
							`applicationFamily_id` SMALLINT(6)
							,',RPT_XDR_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`applicationFamily_id`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_apptype_lte_dy_',DATA_DATE,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_apptype_lte_dy_',DATA_DATE,'` (	
							`DATA_DATE` DATE NOT NULL,							
							`applicationStack_id` SMALLINT(6)
							,',RPT_XDR_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`applicationStack_id`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_top_apptype_lte_dy_',DATA_DATE,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_top_apptype_lte_dy_',DATA_DATE,'` (	
							`DATA_DATE` DATE NOT NULL,
							`applicationStack_id` SMALLINT(6),
							`IMSI` VARCHAR(16),
							`IMEI` VARCHAR(16)
							,',RPT_XDR_TOP_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`applicationStack_id`,`IMSI`,`IMEI`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_top_sub_lte_dy_',DATA_DATE,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_top_sub_lte_dy_',DATA_DATE,'` (	
							`DATA_DATE` DATE NOT NULL,
							`IMSI` VARCHAR(16),
							`IMEI` VARCHAR(16)
							,',RPT_XDR_TOP_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`IMSI`,`IMEI`)
						,KEY `IX_TIME_IMSI` (`DATA_DATE`,`IMSI`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
	END IF;
	
	IF TECH_MASK=2 AND RPT_TYPE = '2' THEN 
	
	-- XDR HR UMTS	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_apn_umts_hr_',DATA_DATE,'_',DATA_HOUR,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_apn_umts_hr_',DATA_DATE,'_',DATA_HOUR,'` (	
							`DATA_DATE` DATE NOT NULL,
							`DATA_HOUR` TINYINT(4) NOT NULL,
							`APN`VARCHAR(50)
							,',RPT_XDR_COL_STR,'
						        ,PRIMARY KEY(`DATA_DATE`,`DATA_HOUR`,`APN`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_appfamily_umts_hr_',DATA_DATE,'_',DATA_HOUR,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;				
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_appfamily_umts_hr_',DATA_DATE,'_',DATA_HOUR,'` (	
							`DATA_DATE` DATE NOT NULL,
							`DATA_HOUR` TINYINT(4) NOT NULL,
							`applicationFamily_id` SMALLINT(6)
							,',RPT_XDR_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`DATA_HOUR`,`applicationFamily_id`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_apptype_umts_hr_',DATA_DATE,'_',DATA_HOUR,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_apptype_umts_hr_',DATA_DATE,'_',DATA_HOUR,'` (	
							`DATA_DATE` DATE NOT NULL,
							`DATA_HOUR` TINYINT(4) NOT NULL,
							`applicationStack_id` SMALLINT(6)
							,',RPT_XDR_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`DATA_HOUR`,`applicationStack_id`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_top_apptype_umts_hr_',DATA_DATE,'_',DATA_HOUR,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_top_apptype_umts_hr_',DATA_DATE,'_',DATA_HOUR,'` (	
							`DATA_DATE` DATE NOT NULL,
							`DATA_HOUR` TINYINT(4) NOT NULL,
							`applicationStack_id` SMALLINT(6),
							`IMSI` VARCHAR(16),
							`IMEI` VARCHAR(16)
							,',RPT_XDR_TOP_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`DATA_HOUR`,`applicationStack_id`,`IMSI`,`IMEI`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_top_sub_umts_hr_',DATA_DATE,'_',DATA_HOUR,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_top_sub_umts_hr_',DATA_DATE,'_',DATA_HOUR,'` (	
							`DATA_DATE` DATE NOT NULL,
							`DATA_HOUR` TINYINT(4) NOT NULL,						
							`IMSI` VARCHAR(16),
							`IMEI` VARCHAR(16)
							,',RPT_XDR_TOP_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`DATA_HOUR`,`IMSI`,`IMEI`)
						,KEY `IX_TIME_IMSI` (`DATA_DATE`,`DATA_HOUR`,`IMSI`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	END IF;
	
	IF TECH_MASK=2 AND RPT_TYPE = '3' THEN 
	-- XDR DY UMTS
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_apn_umts_dy_',DATA_DATE,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_apn_umts_dy_',DATA_DATE,'` (	
							`DATA_DATE` DATE NOT NULL,							
							`APN`VARCHAR(50)
							,',RPT_XDR_COL_STR,'
						        ,PRIMARY KEY(`DATA_DATE`,`APN`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_appfamily_umts_dy_',DATA_DATE,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_appfamily_umts_dy_',DATA_DATE,'` (	
							`DATA_DATE` DATE NOT NULL,							
							`applicationFamily_id` SMALLINT(6)
							,',RPT_XDR_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`applicationFamily_id`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_apptype_umts_dy_',DATA_DATE,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_apptype_umts_dy_',DATA_DATE,'` (	
							`DATA_DATE` DATE NOT NULL,							
							`applicationStack_id` SMALLINT(6)
							,',RPT_XDR_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`applicationStack_id`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_top_apptype_umts_dy_',DATA_DATE,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_top_apptype_umts_dy_',DATA_DATE,'` (	
							`DATA_DATE` DATE NOT NULL,
							`applicationStack_id` SMALLINT(6),
							`IMSI` VARCHAR(16),
							`IMEI` VARCHAR(16)
							,',RPT_XDR_TOP_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`applicationStack_id`,`IMSI`,`IMEI`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',gt_polystar_db,'.rpt_xdr_top_sub_umts_dy_',DATA_DATE,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS ',gt_polystar_db,'.`rpt_xdr_top_sub_umts_dy_',DATA_DATE,'` (	
							`DATA_DATE` DATE NOT NULL,
							`IMSI` VARCHAR(16),
							`IMEI` VARCHAR(16)
							,',RPT_XDR_TOP_COL_STR,'
						    ,PRIMARY KEY(`DATA_DATE`,`IMSI`,`IMEI`)
						,KEY `IX_TIME_IMSI` (`DATA_DATE`,`IMSI`)
						) ENGINE=MYISAM DEFAULT CHARSET=latin1 DELAY_KEY_WRITE=1;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
	END IF;
	
	INSERT INTO gt_gw_main.SP_LOG VALUES(GT_DB,'SP_Polystar_Create_Tmp_Table2',CONCAT('Done: ',TIMESTAMPDIFF(SECOND,START_TIME,SYSDATE()),' seconds.'), NOW());
