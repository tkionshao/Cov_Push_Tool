CREATE DEFINER=`covmo`@`%` PROCEDURE `SP_Sub_Set_Session_Param`(IN GT_DB VARCHAR(100) )
BEGIN
	DECLARE READ_SET INT;
	DECLARE STARTHOUR VARCHAR(2) DEFAULT SUBSTRING(RIGHT(GT_DB,18),10,2);
	DECLARE ENDHOUR VARCHAR(2) DEFAULT IF(SUBSTRING(RIGHT(GT_DB,18),15,2)='00','24',SUBSTRING(RIGHT(GT_DB,18),15,2));
	DECLARE SH_EH VARCHAR(9) DEFAULT RIGHT(GT_DB,9);	
	SELECT REPLACE(GT_DB,SH_EH,'0000_0000') INTO GT_DB;
	SET @SqlCmd=CONCAT('SELECT COUNT(*) INTO @V_CNT_TABLE_CALL FROM ',GT_DB,'.TABLE_CALL WHERE DATA_HOUR >=',STARTHOUR,' AND DATA_HOUR< ',ENDHOUR);
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;		
	
	SET READ_SET =CEIL(310*@V_CNT_tABLE_CALL/POWER(1024,2))*POWER(1024,2);
	
	SET SESSION max_heap_table_size=READ_SET*2;
	SET SESSION tmp_table_size=READ_SET*2;	
	IF READ_SET >POWER(1024,3) THEN		
	SET SESSION read_buffer_size=1024*1024*1024;
	ELSE	
	SET SESSION read_buffer_size=READ_SET;
	END IF;
