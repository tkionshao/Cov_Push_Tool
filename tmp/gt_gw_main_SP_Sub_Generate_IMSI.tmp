CREATE DEFINER=`covmo`@`%` PROCEDURE `SP_Sub_Generate_IMSI`(IN GT_DB VARCHAR(100), IN KIND VARCHAR(20), IN VENDOR_SOURCE VARCHAR(20),IN GT_COVMO VARCHAR(100))
BEGIN
	DECLARE RNC_ID INT;
	DECLARE O_GT_DB VARCHAR(100) DEFAULT GT_DB;
	DECLARE START_TIME DATETIME DEFAULT SYSDATE();
	DECLARE PARTITION_ID INT DEFAULT SUBSTRING(RIGHT(GT_DB,18),10,2) ;
	DECLARE SH_EH VARCHAR(9) DEFAULT RIGHT(GT_DB,9);
	DECLARE STARTHOUR VARCHAR(2) DEFAULT SUBSTRING(RIGHT(GT_DB,18),10,2);
	DECLARE ENDHOUR VARCHAR(2) DEFAULT IF(SUBSTRING(RIGHT(GT_DB,18),15,2)='00','24',SUBSTRING(RIGHT(GT_DB,18),15,2));
	DECLARE RUN VARCHAR(20);
	DECLARE WORKER_ID VARCHAR(10) DEFAULT CONNECTION_ID();
	DECLARE CURRENT_NT_DB VARCHAR(50) DEFAULT CONCAT('gt_nt_',gt_strtok(GT_DB,3,'_'));
 	SELECT gt_strtok(GT_DB,2,'_') INTO RNC_ID;
	
	
	CALL SP_Sub_Set_Session_Param(GT_DB);
	SELECT REPLACE(GT_DB,SH_EH,'0000_0000') INTO GT_DB;
	
	IF VENDOR_SOURCE = 'GW' THEN
		IF KIND = 'DAILY' THEN
			SET RUN = '_tmp';
		ELSEIF KIND = 'RERUN' THEN
			SET RUN = '_rerun';
		END IF;
	ELSEIF VENDOR_SOURCE = 'AP' THEN
		SET RUN = '';
	END IF;
	SET @SqlCmd=CONCAT('ALTER TABLE ',GT_DB,RUN,'.table_imsi_report TRUNCATE PARTITION h',PARTITION_ID,';');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	
	INSERT INTO gt_gw_main.sp_log VALUES(O_GT_DB,'SP_Sub_Generate_IMSI','Create temp table tmp_table_imsi_report ', NOW());
	
	SET @SqlCmd=CONCAT('DROP TEMPORARY TABLE  IF EXISTS ',GT_DB,RUN,'.tmp_table_imsi_report_',WORKER_ID,';');
	PREPARE stmt FROM @sqlcmd;
	EXECUTE stmt;
	DEALLOCATE PREPARE stmt;
	
	SET @SqlCmd=CONCAT('CREATE TEMPORARY TABLE ',GT_DB,RUN,'.`tmp_table_imsi_report_',WORKER_ID,'` 
				SELECT * FROM ',GT_DB,RUN,'.table_imsi_report WHERE 1<>1;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt; 
	INSERT INTO gt_gw_main.sp_log VALUES(O_GT_DB,'SP_Sub_Generate_IMSI','Insert Data to tmp_table_imsi_report', NOW());
	
	SET @SqlCmd=CONCAT('INSERT INTO  ',GT_DB,RUN,'.`tmp_table_imsi_report_',WORKER_ID,'`
				(
				DATA_DATE,DATA_HOUR,IMSI,CALL_CNT,VOICE_MO_CNT,VOICE_MT_CNT,VIDEO_MO_CNT,
				VIDEO_MT_CNT,R99_MO_CNT,R99_MT_CNT,HSPA_MO_CNT,HSPA_MT_CNT,MRAB_MO_CNT,
				MRAB_MT_CNT,SIGNAL_MO_CNT,SIGNAL_MT_CNT,SMS_MO_CNT,SMS_MT_CNT,PS_OTHER_CNT,
				CALL_DUR_SUM,VOICE_DUR_SUM,VIDEO_DUR_SUM,R99_DUR_SUM,HSPA_DUR_SUM,MRAB_DUR_SUM,
				DROP_CNT,BLOCK_CNT,DROP_RF_CNT,DROP_CONG_CNT,DROP_TRANS_CNT,DROP_SHO_CNT,
				DROP_HHO_CNT,DROP_IRAT_CNT,DROP_VOICE_CNT,DROP_VIDEO_CNT,DROP_R99_CNT,DROP_HSPA_CNT,
				DROP_MRAB_CNT,SHO_ATTEMPT_CNT,SHO_FAILURE_CNT,HHO_ATTEMPT_CNT,HHO_FAILURE_CNT,
				IRAT_ATTEMPT_CNT,IRAT_FAILURE_CNT,MOVING_CALL_CNT,INDOOR_CALL_CNT,PS_UL_VOLUME_SUM,
				PS_DL_VOLUME_SUM,PS_UL_SPEED_MAX,PS_DL_SPEED_MAX,FIRST_RSCP_SUM,FIRST_RSCP_CNT,
				FIRST_ECNO_SUM,FIRST_ECNO_CNT,MAKE_ID,MODEL_ID
				)
				SELECT
					DATA_DATE
					,DATA_HOUR
					,IMSI
					,COUNT(*) AS CALL_CNT
					,SUM(IF(CALL_TYPE=10 AND RRC_REQUEST_TYPE IN (0,1,2,3,4,9,10,11,12,13,14,15,16,21),1,0)) AS VOICE_MO_CNT
					,SUM(IF(CALL_TYPE=10 AND RRC_REQUEST_TYPE IN (5,6,7,8,17,18,19,20),1,0)) AS VOICE_MT_CNT
					,SUM(IF(CALL_TYPE=11 AND RRC_REQUEST_TYPE IN (0,1,2,3,4,9,10,11,12,13,14,15,16,21),1,0)) AS VIDEO_MO_CNT
					,SUM(IF(CALL_TYPE=11 AND RRC_REQUEST_TYPE IN (5,6,7,8,17,18,19,20),1,0)) AS VIDEO_MT_CNT
					,SUM(IF(CALL_TYPE=12 AND RRC_REQUEST_TYPE IN (0,1,2,3,4,9,10,11,12,13,14,15,16,21),1,0)) AS R99_MO_CNT
					,SUM(IF(CALL_TYPE=12 AND RRC_REQUEST_TYPE IN (5,6,7,8,17,18,19,20),1,0)) AS R99_MT_CNT
					,SUM(IF(CALL_TYPE=13 AND RRC_REQUEST_TYPE IN (0,1,2,3,4,9,10,11,12,13,14,15,16,21),1,0)) AS HSPA_MO_CNT
					,SUM(IF(CALL_TYPE=13 AND RRC_REQUEST_TYPE IN (5,6,7,8,17,18,19,20),1,0)) AS HSPA_MT_CNT
					,SUM(IF(CALL_TYPE=14 AND RRC_REQUEST_TYPE IN (0,1,2,3,4,9,10,11,12,13,14,15,16,21),1,0)) AS MRAB_MO_CNT
					,SUM(IF(CALL_TYPE=14 AND RRC_REQUEST_TYPE IN (5,6,7,8,17,18,19,20),1,0)) AS MRAB_MT_CNT
					,SUM(IF(CALL_TYPE=15 AND RRC_REQUEST_TYPE IN (0,1,2,3,4,9,10,11,12,13,14,15,16,21),1,0)) AS SIGNAL_MO_CNT
					,SUM(IF(CALL_TYPE=15 AND RRC_REQUEST_TYPE IN (5,6,7,8,17,18,19,20),1,0)) AS SIGNAL_MT_CNT
					,SUM(IF(CALL_TYPE=16 AND RRC_REQUEST_TYPE IN (0,1,2,3,4,9,10,11,12,13,14,15,16,21),1,0)) AS SMS_MO_CNT
					,SUM(IF(CALL_TYPE=16 AND RRC_REQUEST_TYPE IN (5,6,7,8,17,18,19,20),1,0)) AS SMS_MT_CNT
					,SUM(IF(CALL_TYPE=18,1,0)) AS PS_OTHER_CNT
					,SUM(RRC_CONNECT_DURATION) AS CALL_DUR_SUM
					,SUM(IF(CALL_TYPE=10,RRC_CONNECT_DURATION,0)) AS VOICE_DUR_SUM
					,SUM(IF(CALL_TYPE=11,RRC_CONNECT_DURATION,0)) AS VIDEO_DUR_SUM
					,SUM(IF(CALL_TYPE=12,RRC_CONNECT_DURATION,0)) AS R99_DUR_SUM
					,SUM(IF(CALL_TYPE=13,RRC_CONNECT_DURATION,0)) AS HSPA_DUR_SUM
					,SUM(IF(CALL_TYPE=14,RRC_CONNECT_DURATION,0)) AS MRAB_DUR_SUM
					,SUM(IF(CALL_STATUS=2,1,0)) AS DROP_CNT
					,SUM(IF(CALL_STATUS=3,1,0)) AS BLOCK_CNT
					,SUM(IF(VENDOR_DROP_CAUSE IN (100,101,102,103,104),1,0)) AS DROP_RF_CNT
					,SUM(IF(VENDOR_DROP_CAUSE IN (201),1,0)) AS DROP_CONG_CNT
					,SUM(IF(VENDOR_DROP_CAUSE IN (300, 301, 302, 303),1,0)) AS DROP_TRANS_CNT
					,SUM(IF(VENDOR_DROP_CAUSE IN (600,601,602,603,604,605,606),1,0)) AS DROP_SHO_CNT
					,SUM(IF(VENDOR_DROP_CAUSE IN (1001,1101,1102),1,0)) AS DROP_HHO_CNT
					,SUM(IF(VENDOR_DROP_CAUSE IN (701,702),1,0)) AS DROP_IRAT_CNT
					,SUM(IF(CALL_STATUS=2 AND CALL_TYPE=10,1,0)) AS DROP_VOICE_CNT
					,SUM(IF(CALL_STATUS=2 AND CALL_TYPE=11,1,0)) AS DROP_VIDEO_CNT
					,SUM(IF(CALL_STATUS=2 AND CALL_TYPE=12,1,0)) AS DROP_R99_CNT
					,SUM(IF(CALL_STATUS=2 AND CALL_TYPE=13,1,0)) AS DROP_HSPA_CNT
					,SUM(IF(CALL_STATUS=2 AND CALL_TYPE=14,1,0)) AS DROP_MRAB_CNT
					,SUM(SHO) AS SHO_ATTEMPT_CNT
					,0 AS SHO_FAILURE_CNT
					,IFNULL(SUM(IFHO),0) AS HHO_ATTEMPT_CNT 
					,IFNULL((SUM(IFHO)-COUNT(POS_IFHO_CELL)),0) AS HHO_FAILURE_CNT
					,IFNULL(SUM(IRAT_HHO_ATTEMPT),0) AS IRAT_ATTEMPT_CNT
					,IFNULL(SUM(IRAT_HHO_ATTEMPT-`IRAT_HHO_SUCCESS`),0) AS IRAT_FAILURE_CNT
					,SUM(IF(INDOOR=0 AND MOVING=1,1,0)) AS MOVING_CALL_CNT
					,SUM(IF(INDOOR=1,1,0)) AS INDOOR_CALL_CNT
					,IFNULL(SUM(IF(CALL_TYPE IN (12,13,14,18),UL_TRAFFIC_VOLUME,0)),0) AS PS_UL_VOLUME_SUM
					,IFNULL(SUM(IF(CALL_TYPE IN (12,13,14,18),DL_TRAFFIC_VOLUME,0)),0) AS PS_DL_VOLUME_SUM
					,MAX(IF(CALL_TYPE IN (12,13,14,18),UL_THROUGHPUT_AVG,0)) AS PS_UL_SPEED_MAX
					,MAX(IF(CALL_TYPE IN (12,13,14,18),DL_THROUGHPUT_AVG,0)) AS PS_DL_SPEED_MAX
					,SUM(POS_FIRST_RSCP) AS FIRST_RSCP_SUM
					,COUNT(POS_FIRST_RSCP) AS FIRST_RSCP_CNT
					,SUM(POS_FIRST_ECN0) AS FIRST_ECNO_SUM
					,COUNT(POS_FIRST_ECN0) AS FIRST_ECNO_CNT
					,MAKE_ID
					,MODEL_ID
				FROM ',GT_DB,RUN,'.table_call
				WHERE IMSI IS NOT NULL
				AND DATA_HOUR >= ',STARTHOUR,' AND DATA_HOUR < ',ENDHOUR,'
				GROUP BY 
					DATA_HOUR
					,IMSI
				ORDER BY NULL;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	
	
	INSERT INTO gt_gw_main.sp_log VALUES(O_GT_DB,'SP_Sub_Generate_IMSI','Insert Data to table_imsi_report', NOW());
	SET @SqlCmd=CONCAT('INSERT INTO  ',GT_DB,RUN,'.`table_imsi_report`	
				(
					DATA_DATE,DATA_HOUR,IMSI,CALL_CNT,VOICE_MO_CNT,VOICE_MT_CNT,VIDEO_MO_CNT,
					VIDEO_MT_CNT,R99_MO_CNT,R99_MT_CNT,HSPA_MO_CNT,HSPA_MT_CNT,MRAB_MO_CNT,
					MRAB_MT_CNT,SIGNAL_MO_CNT,SIGNAL_MT_CNT,SMS_MO_CNT,SMS_MT_CNT,PS_OTHER_CNT,
					CALL_DUR_SUM,VOICE_DUR_SUM,VIDEO_DUR_SUM,R99_DUR_SUM,HSPA_DUR_SUM,MRAB_DUR_SUM,
					DROP_CNT,BLOCK_CNT,DROP_RF_CNT,DROP_CONG_CNT,DROP_TRANS_CNT,DROP_SHO_CNT,
					DROP_HHO_CNT,DROP_IRAT_CNT,DROP_VOICE_CNT,DROP_VIDEO_CNT,DROP_R99_CNT,DROP_HSPA_CNT,
					DROP_MRAB_CNT,SHO_ATTEMPT_CNT,SHO_FAILURE_CNT,HHO_ATTEMPT_CNT,HHO_FAILURE_CNT,
					IRAT_ATTEMPT_CNT,IRAT_FAILURE_CNT,MOVING_CALL_CNT,INDOOR_CALL_CNT,PS_UL_VOLUME_SUM,
					PS_DL_VOLUME_SUM,PS_UL_SPEED_MAX,PS_DL_SPEED_MAX,FIRST_RSCP_SUM,FIRST_RSCP_CNT,
					FIRST_ECNO_SUM,FIRST_ECNO_CNT,MAKE_ID,MODEL_ID
				)
				SELECT
					DATA_DATE,DATA_HOUR,IMSI,CALL_CNT,VOICE_MO_CNT,VOICE_MT_CNT,VIDEO_MO_CNT,
					VIDEO_MT_CNT,R99_MO_CNT,R99_MT_CNT,HSPA_MO_CNT,HSPA_MT_CNT,MRAB_MO_CNT,
					MRAB_MT_CNT,SIGNAL_MO_CNT,SIGNAL_MT_CNT,SMS_MO_CNT,SMS_MT_CNT,PS_OTHER_CNT,
					CALL_DUR_SUM,VOICE_DUR_SUM,VIDEO_DUR_SUM,R99_DUR_SUM,HSPA_DUR_SUM,MRAB_DUR_SUM,
					DROP_CNT,BLOCK_CNT,DROP_RF_CNT,DROP_CONG_CNT,DROP_TRANS_CNT,DROP_SHO_CNT,
					DROP_HHO_CNT,DROP_IRAT_CNT,DROP_VOICE_CNT,DROP_VIDEO_CNT,DROP_R99_CNT,DROP_HSPA_CNT,
					DROP_MRAB_CNT,SHO_ATTEMPT_CNT,SHO_FAILURE_CNT,HHO_ATTEMPT_CNT,HHO_FAILURE_CNT,
					IRAT_ATTEMPT_CNT,IRAT_FAILURE_CNT,MOVING_CALL_CNT,INDOOR_CALL_CNT,PS_UL_VOLUME_SUM,
					PS_DL_VOLUME_SUM,PS_UL_SPEED_MAX,PS_DL_SPEED_MAX,FIRST_RSCP_SUM,FIRST_RSCP_CNT,
					FIRST_ECNO_SUM,FIRST_ECNO_CNT,MAKE_ID,MODEL_ID
				FROM ',GT_DB,RUN,'.`tmp_table_imsi_report_',WORKER_ID,'`;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	INSERT INTO gt_gw_main.sp_log VALUES(O_GT_DB,'SP_Sub_Generate_IMSI','Insert Data to table_imsi_report_dy', NOW());
	SET @SqlCmd=CONCAT('INSERT INTO ',GT_DB,'.table_imsi_report_dy
		(
		IMSI,CALL_CNT,VOICE_MO_CNT,VOICE_MT_CNT,VIDEO_MO_CNT,
		VIDEO_MT_CNT,R99_MO_CNT,R99_MT_CNT,HSPA_MO_CNT,HSPA_MT_CNT,MRAB_MO_CNT,
		MRAB_MT_CNT,SIGNAL_MO_CNT,SIGNAL_MT_CNT,SMS_MO_CNT,SMS_MT_CNT,PS_OTHER_CNT,
		CALL_DUR_SUM,VOICE_DUR_SUM,VIDEO_DUR_SUM,R99_DUR_SUM,HSPA_DUR_SUM,MRAB_DUR_SUM,
		DROP_CNT,BLOCK_CNT,DROP_RF_CNT,DROP_CONG_CNT,DROP_TRANS_CNT,DROP_SHO_CNT,
		DROP_HHO_CNT,DROP_IRAT_CNT,DROP_VOICE_CNT,DROP_VIDEO_CNT,DROP_R99_CNT,DROP_HSPA_CNT,
		DROP_MRAB_CNT,SHO_ATTEMPT_CNT,SHO_FAILURE_CNT,HHO_ATTEMPT_CNT,HHO_FAILURE_CNT,
		IRAT_ATTEMPT_CNT,IRAT_FAILURE_CNT,MOVING_CALL_CNT,INDOOR_CALL_CNT,PS_UL_VOLUME_SUM,
		PS_DL_VOLUME_SUM,PS_UL_SPEED_MAX,PS_DL_SPEED_MAX,FIRST_RSCP_SUM,FIRST_RSCP_CNT,
		FIRST_ECNO_SUM,FIRST_ECNO_CNT,MAKE_ID,MODEL_ID
		)
	SELECT	
		IMSI
		,IFNULL(SUM(CALL_CNT),0) AS CALL_CNT
		,IFNULL(SUM(VOICE_MO_CNT),0) AS VOICE_MO_CNT
		,IFNULL(SUM(VOICE_MT_CNT),0) ASVOICE_MT_CNT
		,IFNULL(SUM(VIDEO_MO_CNT),0) ASVIDEO_MO_CNT
		,IFNULL(SUM(VIDEO_MT_CNT),0) ASVIDEO_MT_CNT
		,IFNULL(SUM(R99_MO_CNT),0) ASR99_MO_CNT
		,IFNULL(SUM(R99_MT_CNT),0) ASR99_MT_CNT
		,IFNULL(SUM(HSPA_MO_CNT),0) ASHSPA_MO_CNT
		,IFNULL(SUM(HSPA_MT_CNT),0) ASHSPA_MT_CNT
		,IFNULL(SUM(MRAB_MO_CNT),0) ASMRAB_MO_CNT
		,IFNULL(SUM(MRAB_MT_CNT),0) ASMRAB_MT_CNT
		,IFNULL(SUM(SIGNAL_MO_CNT),0) ASSIGNAL_MO_CNT
		,IFNULL(SUM(SIGNAL_MT_CNT),0) ASSIGNAL_MT_CNT
		,IFNULL(SUM(SMS_MO_CNT),0) ASSMS_MO_CNT
		,IFNULL(SUM(SMS_MT_CNT),0) ASSMS_MT_CNT
		,IFNULL(SUM(PS_OTHER_CNT),0) ASPS_OTHER_CNT
		,IFNULL(SUM(CALL_DUR_SUM),0) ASCALL_DUR_SUM
		,IFNULL(SUM(VOICE_DUR_SUM),0) ASVOICE_DUR_SUM
		,IFNULL(SUM(VIDEO_DUR_SUM),0) ASVIDEO_DUR_SUM
		,IFNULL(SUM(R99_DUR_SUM),0) ASR99_DUR_SUM
		,IFNULL(SUM(HSPA_DUR_SUM),0) ASHSPA_DUR_SUM
		,IFNULL(SUM(MRAB_DUR_SUM),0) ASMRAB_DUR_SUM
		,IFNULL(SUM(DROP_CNT),0) ASDROP_CNT
		,IFNULL(SUM(BLOCK_CNT),0) ASBLOCK_CNT
		,IFNULL(SUM(DROP_RF_CNT),0) ASDROP_RF_CNT
		,IFNULL(SUM(DROP_CONG_CNT),0) ASDROP_CONG_CNT
		,IFNULL(SUM(DROP_TRANS_CNT),0) ASDROP_TRANS_CNT
		,IFNULL(SUM(DROP_SHO_CNT),0) ASDROP_SHO_CNT
		,IFNULL(SUM(DROP_HHO_CNT),0) ASDROP_HHO_CNT
		,IFNULL(SUM(DROP_IRAT_CNT),0) ASDROP_IRAT_CNT
		,IFNULL(SUM(DROP_VOICE_CNT),0) ASDROP_VOICE_CNT
		,IFNULL(SUM(DROP_VIDEO_CNT),0) ASDROP_VIDEO_CNT
		,IFNULL(SUM(DROP_R99_CNT),0) ASDROP_R99_CNT
		,IFNULL(SUM(DROP_HSPA_CNT),0) ASDROP_HSPA_CNT
		,IFNULL(SUM(DROP_MRAB_CNT),0) ASDROP_MRAB_CNT
		,IFNULL(SUM(SHO_ATTEMPT_CNT),0) ASSHO_ATTEMPT_CNT
		,IFNULL(SUM(SHO_FAILURE_CNT),0) ASSHO_FAILURE_CNT
		,IFNULL(SUM(HHO_ATTEMPT_CNT),0) ASHHO_ATTEMPT_CNT
		,IFNULL(SUM(HHO_FAILURE_CNT),0) ASHHO_FAILURE_CNT
		,IFNULL(SUM(IRAT_ATTEMPT_CNT),0) ASIRAT_ATTEMPT_CNT
		,IFNULL(SUM(IRAT_FAILURE_CNT),0) ASIRAT_FAILURE_CNT
		,IFNULL(SUM(MOVING_CALL_CNT),0) ASMOVING_CALL_CNT
		,IFNULL(SUM(INDOOR_CALL_CNT),0) ASINDOOR_CALL_CNT
		,IFNULL(SUM(PS_UL_VOLUME_SUM),0) ASPS_UL_VOLUME_SUM
		,IFNULL(SUM(PS_DL_VOLUME_SUM),0) ASPS_DL_VOLUME_SUM
		,IFNULL(SUM(PS_UL_SPEED_MAX),0) ASPS_UL_SPEED_MAX
		,IFNULL(SUM(PS_DL_SPEED_MAX),0) ASPS_DL_SPEED_MAX
		,IFNULL(SUM(FIRST_RSCP_SUM),0) ASFIRST_RSCP_SUM
		,IFNULL(SUM(FIRST_RSCP_CNT),0) ASFIRST_RSCP_CNT
		,IFNULL(SUM(FIRST_ECNO_SUM),0) ASFIRST_ECNO_SUM
		,IFNULL(SUM(FIRST_ECNO_CNT),0) ASFIRST_ECNO_CNT
		,MAKE_ID
		,MODEL_ID
	FROM ',GT_DB,RUN,'.`tmp_table_imsi_report_',WORKER_ID,'`
	GROUP BY IMSI
	ON DUPLICATE KEY UPDATE 			
		',GT_DB,'.table_imsi_report_dy.`CALL_CNT`=',GT_DB,'.table_imsi_report_dy.`CALL_CNT`+VALUES(CALL_CNT)
		,',GT_DB,'.table_imsi_report_dy.`VOICE_MO_CNT`=',GT_DB,'.table_imsi_report_dy.`VOICE_MO_CNT`+VALUES(VOICE_MO_CNT)
		,',GT_DB,'.table_imsi_report_dy.`VOICE_MT_CNT`=',GT_DB,'.table_imsi_report_dy.`VOICE_MT_CNT`+VALUES(VOICE_MT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`VIDEO_MO_CNT`=',GT_DB,'.table_imsi_report_dy.`VIDEO_MO_CNT`+VALUES(VIDEO_MO_CNT)
		,',GT_DB,'.table_imsi_report_dy.`VIDEO_MT_CNT`=',GT_DB,'.table_imsi_report_dy.`VIDEO_MT_CNT`+VALUES(VIDEO_MT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`R99_MO_CNT`=',GT_DB,'.table_imsi_report_dy.`R99_MO_CNT`+VALUES(R99_MO_CNT)
		,',GT_DB,'.table_imsi_report_dy.`R99_MT_CNT`=',GT_DB,'.table_imsi_report_dy.`R99_MT_CNT`+VALUES(R99_MT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`HSPA_MO_CNT`=',GT_DB,'.table_imsi_report_dy.`HSPA_MO_CNT`+VALUES(HSPA_MO_CNT)
		,',GT_DB,'.table_imsi_report_dy.`HSPA_MT_CNT`=',GT_DB,'.table_imsi_report_dy.`HSPA_MT_CNT`+VALUES(HSPA_MT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`MRAB_MO_CNT`=',GT_DB,'.table_imsi_report_dy.`MRAB_MO_CNT`+VALUES(MRAB_MO_CNT)
		,',GT_DB,'.table_imsi_report_dy.`MRAB_MT_CNT`=',GT_DB,'.table_imsi_report_dy.`MRAB_MT_CNT`+VALUES(MRAB_MT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`SIGNAL_MO_CNT`=',GT_DB,'.table_imsi_report_dy.`SIGNAL_MO_CNT`+VALUES(SIGNAL_MO_CNT)
		,',GT_DB,'.table_imsi_report_dy.`SIGNAL_MT_CNT`=',GT_DB,'.table_imsi_report_dy.`SIGNAL_MT_CNT`+VALUES(SIGNAL_MT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`SMS_MO_CNT`=',GT_DB,'.table_imsi_report_dy.`SMS_MO_CNT`+VALUES(SMS_MO_CNT)
		,',GT_DB,'.table_imsi_report_dy.`SMS_MT_CNT`=',GT_DB,'.table_imsi_report_dy.`SMS_MT_CNT`+VALUES(SMS_MT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`PS_OTHER_CNT`=',GT_DB,'.table_imsi_report_dy.`PS_OTHER_CNT`+VALUES(PS_OTHER_CNT)
		,',GT_DB,'.table_imsi_report_dy.`CALL_DUR_SUM`=',GT_DB,'.table_imsi_report_dy.`CALL_DUR_SUM`+VALUES(CALL_DUR_SUM)
		,',GT_DB,'.table_imsi_report_dy.`VOICE_DUR_SUM`=',GT_DB,'.table_imsi_report_dy.`VOICE_DUR_SUM`+VALUES(VOICE_DUR_SUM)
		,',GT_DB,'.table_imsi_report_dy.`VIDEO_DUR_SUM`=',GT_DB,'.table_imsi_report_dy.`VIDEO_DUR_SUM`+VALUES(VIDEO_DUR_SUM)
		,',GT_DB,'.table_imsi_report_dy.`R99_DUR_SUM`=',GT_DB,'.table_imsi_report_dy.`R99_DUR_SUM`+VALUES(R99_DUR_SUM)
		,',GT_DB,'.table_imsi_report_dy.`HSPA_DUR_SUM`=',GT_DB,'.table_imsi_report_dy.`HSPA_DUR_SUM`+VALUES(HSPA_DUR_SUM)
		,',GT_DB,'.table_imsi_report_dy.`MRAB_DUR_SUM`=',GT_DB,'.table_imsi_report_dy.`MRAB_DUR_SUM`+VALUES(MRAB_DUR_SUM)
		,',GT_DB,'.table_imsi_report_dy.`DROP_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_CNT`+VALUES(DROP_CNT)
		,',GT_DB,'.table_imsi_report_dy.`BLOCK_CNT`=',GT_DB,'.table_imsi_report_dy.`BLOCK_CNT`+VALUES(BLOCK_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_RF_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_RF_CNT`+VALUES(DROP_RF_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_CONG_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_CONG_CNT`+VALUES(DROP_CONG_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_TRANS_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_TRANS_CNT`+VALUES(DROP_TRANS_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_SHO_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_SHO_CNT`+VALUES(DROP_SHO_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_HHO_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_HHO_CNT`+VALUES(DROP_HHO_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_IRAT_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_IRAT_CNT`+VALUES(DROP_IRAT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_VOICE_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_VOICE_CNT`+VALUES(DROP_VOICE_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_VIDEO_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_VIDEO_CNT`+VALUES(DROP_VIDEO_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_R99_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_R99_CNT`+VALUES(DROP_R99_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_HSPA_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_HSPA_CNT`+VALUES(DROP_HSPA_CNT)
		,',GT_DB,'.table_imsi_report_dy.`DROP_MRAB_CNT`=',GT_DB,'.table_imsi_report_dy.`DROP_MRAB_CNT`+VALUES(DROP_MRAB_CNT)
		,',GT_DB,'.table_imsi_report_dy.`SHO_ATTEMPT_CNT`=',GT_DB,'.table_imsi_report_dy.`SHO_ATTEMPT_CNT`+VALUES(SHO_ATTEMPT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`SHO_FAILURE_CNT`=',GT_DB,'.table_imsi_report_dy.`SHO_FAILURE_CNT`+VALUES(SHO_FAILURE_CNT)
		,',GT_DB,'.table_imsi_report_dy.`HHO_ATTEMPT_CNT`=',GT_DB,'.table_imsi_report_dy.`HHO_ATTEMPT_CNT`+VALUES(HHO_ATTEMPT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`HHO_FAILURE_CNT`=',GT_DB,'.table_imsi_report_dy.`HHO_FAILURE_CNT`+VALUES(HHO_FAILURE_CNT)
		,',GT_DB,'.table_imsi_report_dy.`IRAT_ATTEMPT_CNT`=',GT_DB,'.table_imsi_report_dy.`IRAT_ATTEMPT_CNT`+VALUES(IRAT_ATTEMPT_CNT)
		,',GT_DB,'.table_imsi_report_dy.`IRAT_FAILURE_CNT`=',GT_DB,'.table_imsi_report_dy.`IRAT_FAILURE_CNT`+VALUES(IRAT_FAILURE_CNT)
		,',GT_DB,'.table_imsi_report_dy.`MOVING_CALL_CNT`=',GT_DB,'.table_imsi_report_dy.`MOVING_CALL_CNT`+VALUES(MOVING_CALL_CNT)
		,',GT_DB,'.table_imsi_report_dy.`INDOOR_CALL_CNT`=',GT_DB,'.table_imsi_report_dy.`INDOOR_CALL_CNT`+VALUES(INDOOR_CALL_CNT)
		,',GT_DB,'.table_imsi_report_dy.`PS_UL_VOLUME_SUM`=',GT_DB,'.table_imsi_report_dy.`PS_UL_VOLUME_SUM`+VALUES(PS_UL_VOLUME_SUM)
		,',GT_DB,'.table_imsi_report_dy.`PS_DL_VOLUME_SUM`=',GT_DB,'.table_imsi_report_dy.`PS_DL_VOLUME_SUM`+VALUES(PS_DL_VOLUME_SUM)
		,',GT_DB,'.table_imsi_report_dy.`PS_UL_SPEED_MAX`=',GT_DB,'.table_imsi_report_dy.`PS_UL_SPEED_MAX`+VALUES(PS_UL_SPEED_MAX)
		,',GT_DB,'.table_imsi_report_dy.`PS_DL_SPEED_MAX`=',GT_DB,'.table_imsi_report_dy.`PS_DL_SPEED_MAX`+VALUES(PS_DL_SPEED_MAX)
		,',GT_DB,'.table_imsi_report_dy.`FIRST_RSCP_SUM`=',GT_DB,'.table_imsi_report_dy.`FIRST_RSCP_SUM`+VALUES(FIRST_RSCP_SUM)
		,',GT_DB,'.table_imsi_report_dy.`FIRST_RSCP_CNT`=',GT_DB,'.table_imsi_report_dy.`FIRST_RSCP_CNT`+VALUES(FIRST_RSCP_CNT)
		,',GT_DB,'.table_imsi_report_dy.`FIRST_ECNO_SUM`=',GT_DB,'.table_imsi_report_dy.`FIRST_ECNO_SUM`+VALUES(FIRST_ECNO_SUM)
		,',GT_DB,'.table_imsi_report_dy.`FIRST_ECNO_CNT`=',GT_DB,'.table_imsi_report_dy.`FIRST_ECNO_CNT`+VALUES(FIRST_ECNO_CNT)
		;');			
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	
	
	SET @SqlCmd=CONCAT('DROP TEMPORARY TABLE  IF EXISTS ',GT_DB,RUN,'.tmp_table_imsi_report_',WORKER_ID,';');
	PREPARE stmt FROM @sqlcmd;
	EXECUTE stmt;
	DEALLOCATE PREPARE stmt;
	
	INSERT INTO gt_gw_main.sp_log VALUES(O_GT_DB,'SP_Sub_Generate_IMSI',CONCAT('Done: ',TIMESTAMPDIFF(SECOND,START_TIME,SYSDATE()),' seconds.'), NOW());
			
END
utf8
utf8_general_ci
latin1_swedish_ci
