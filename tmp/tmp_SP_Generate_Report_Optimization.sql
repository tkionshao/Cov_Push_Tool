CREATE DEFINER=`covmo`@`%` PROCEDURE `SP_Generate_Report_Optimization`(IN gt_db VARCHAR(100),IN GT_COVMO VARCHAR(100))
BEGIN	
	DECLARE START_TIME DATETIME DEFAULT SYSDATE();
	DECLARE SH_EH VARCHAR(9) DEFAULT RIGHT(GT_DB,9);
	DECLARE CURRENT_NT_DB VARCHAR(50) DEFAULT CONCAT('gt_nt_',gt_strtok(GT_DB,3,'_'));
	
	SELECT REPLACE(GT_DB,SH_EH,'0000_0000') INTO GT_DB;				 
	INSERT INTO gt_gw_main.SP_LOG VALUES(GT_DB,'SP_Generate_Report_Optimization','START', START_TIME);
	
	CALL GT_GW_MAIN.SP_Sub_Generate_Overshooting_Severity(GT_DB,GT_COVMO);		
	CALL GT_GW_MAIN.Sp_Sub_Generate_ACO_Report(GT_DB);
	CALL GT_GW_MAIN.SP_Sub_Update_NBO_Intra(GT_DB,GT_COVMO);
	CALL GT_GW_MAIN.SP_Sub_Update_NBO_Inter(GT_DB,GT_COVMO);
	CALL GT_GW_MAIN.SP_Sub_Update_NBO_IRat(GT_DB,GT_COVMO);
 	CALL GT_GW_MAIN.SP_Sub_Update_SCO(GT_DB);
	SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',GT_DB,'.tmp_avg_voronoi_distance;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	
	INSERT INTO gt_gw_main.SP_LOG VALUES(GT_DB,'SP_Generate_Report_Optimization',CONCAT('Done: ',TIMESTAMPDIFF(SECOND,START_TIME,SYSDATE()),' seconds.'), NOW());		
