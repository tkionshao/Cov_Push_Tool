CREATE DEFINER=`covmo`@`%` PROCEDURE `SP_Generate_Global_Statistic_DS_Aggr`(IN TECH_MASK TINYINT(2),IN WORKER_ID VARCHAR(10),IN exDate VARCHAR(10),IN TileResolution VARCHAR(10))
BEGIN
	DECLARE START_TIME DATETIME DEFAULT SYSDATE();
	DECLARE STEP_START_TIME DATETIME DEFAULT SYSDATE();
	DECLARE SP_Process VARCHAR(100) DEFAULT NULL;
	DECLARE KPI_ERROR CONDITION FOR SQLSTATE '99999' ;
	DECLARE FIRSTDAY_OF_WEEK TINYINT(4) DEFAULT 6;
	DECLARE v_DATA_DATE VARCHAR(10) DEFAULT NULL;
	DECLARE v_DATA_HOUR TINYINT(2) DEFAULT NULL;
	DECLARE v_PU_ID MEDIUMINT(9) DEFAULT NULL;
	DECLARE v_TECH_MASK TINYINT(2) DEFAULT NULL;
	DECLARE v_group_db_name VARCHAR(100) DEFAULT '';
			
	DECLARE TILE_DS_COLUMN_STR VARCHAR(2000) DEFAULT 
		'RSRP_SUM,
		RSRP_CNT,
		RSCP_SUM,
		RSCP_CNT,
		RXLEV_SUM,
		RXLEV_CNT,
		RSRQ_SUM,
		RSRQ_CNT,
		ECNO_SUM,
		ECNO_CNT,
		RXQUAL_SUM,
		RXQUAL_CNT,
		GSM_CS_CALL_CNT,
		GSM_PS_CALL_CNT,
		GSM_VOICE_DROP_CNT,
		GSM_GPRS_DROP_CNT,
		GSM_SMS_DROP_CNT,
		GSM_CS_BLOCK_CNT,
		GSM_PS_BLOCK_CNT,
		GSM_CS_CALL_DURATION,
		GSM_CALL_SETUP_TIME_SUM,
		GSM_CALL_SETUP_TIME_CNT,
		GSM_CS_CALL_SETUP_TIME_SUM,
		GSM_CS_CALL_SETUP_TIME_CNT,
		GSM_PS_CALL_SETUP_TIME_SUM,
		GSM_PS_CALL_SETUP_TIME_CNT,
		GSM_CS_SETUP_FAILURE_CNT,
		GSM_PS_SETUP_FAILURE_CNT,
		UMTS_CS_CALL_CNT,
		UMTS_PS_CALL_CNT,
		UMTS_VOICE_DROP_CNT,
		UMTS_PS_DROP_CNT,
		UMTS_CS_CALL_DURATION,
		UMTS_CS_BLOCK_CNT,
		UMTS_PS_BLOCK_CNT,
		UMTS_UL_VOLUME,
		UMTS_DL_VOLUME,
		UMTS_UL_THROUPUT_SUM,
		UMTS_UL_THROUPUT_CNT,
		UMTS_DL_THROUPUT_SUM,
		UMTS_DL_THROUPUT_CNT,
		UMTS_CALL_SETUP_TIME_SUM,
		UMTS_CALL_SETUP_TIME_CNT,
		UMTS_CS_CALL_SETUP_TIME_SUM,
		UMTS_CS_CALL_SETUP_TIME_CNT,
		UMTS_PS_CALL_SETUP_TIME_SUM,
		UMTS_PS_CALL_SETUP_TIME_CNT,
		UMTS_CS_SETUP_FAILURE_CNT,
		UMTS_PS_SETUP_FAILURE_CNT,
		UMTS_IRAT_HO_ATMP,
		UMTS_IRAT_HO_FAIL,
		LTE_CALL_CNT,
		LTE_DROP_CNT,
		LTE_BLOCK_CNT,
		LTE_UL_VOLUME,
		LTE_DL_VOLUME,
		LTE_UL_THROUPUT_SUM,
		LTE_UL_THROUPUT_CNT,
		LTE_DL_THROUPUT_SUM,
		LTE_DL_THROUPUT_CNT,
		LATENCY_SUM,
		LATENCY_CNT,
		LTE_CALL_SETUP_TIME_SUM,
		LTE_CALL_SETUP_TIME_CNT,
		LTE_SETUP_FAILURE_CNT,
		SRVCC_ATTEMPT_CNT,
		SRVCC_FAILURE_CNT,
		S1_HO_ATTEMPT,
		S1_HO_FAILURE,
		X2_HO_ATTEMPT,
		X2_HO_FAILURE,
		UMTS_MAX_UL_THROUPUT,
		UMTS_MAX_DL_THROUPUT,
		LTE_MAX_UL_THROUPUT,
		LTE_MAX_DL_THROUPUT,
		LTE_IRAT_TO_UMTS_ATMP,
		LTE_IRAT_TO_GERAN_ATMP,
		LTE_IRAT_TO_CDMA_ATMP,
		LTE_IRAT_TO_UMTS_FAIL,
		LTE_IRAT_TO_GERAN_FAIL,
		LTE_IRAT_TO_CDMA_FAIL';
		  
	DECLARE TILE_DS_COLUMN_IFNULL_STR VARCHAR(6000) DEFAULT 
		'IFNULL(RSRP_SUM,0) AS RSRP_SUM,
		IFNULL(RSRP_CNT,0) AS RSRP_CNT,
		IFNULL(RSCP_SUM,0) AS RSCP_SUM,
		IFNULL(RSCP_CNT,0) AS RSCP_CNT,
		IFNULL(RXLEV_SUM,0) AS RXLEV_SUM,
		IFNULL(RXLEV_CNT,0) AS RXLEV_CNT,
		IFNULL(RSRQ_SUM,0) AS RSRQ_SUM,
		IFNULL(RSRQ_CNT,0) AS RSRQ_CNT,
		IFNULL(ECNO_SUM,0) AS ECNO_SUM,
		IFNULL(ECNO_CNT,0) AS ECNO_CNT,
		IFNULL(RXQUAL_SUM,0) AS RXQUAL_SUM,
		IFNULL(RXQUAL_CNT,0) AS RXQUAL_CNT,
		IFNULL(GSM_CS_CALL_CNT,0) AS GSM_CS_CALL_CNT,
		IFNULL(GSM_PS_CALL_CNT,0) AS GSM_PS_CALL_CNT,
		IFNULL(GSM_VOICE_DROP_CNT,0) AS GSM_VOICE_DROP_CNT,
		IFNULL(GSM_GPRS_DROP_CNT,0) AS GSM_GPRS_DROP_CNT,
		IFNULL(GSM_SMS_DROP_CNT,0) AS GSM_SMS_DROP_CNT,
		IFNULL(GSM_CS_BLOCK_CNT,0) AS GSM_CS_BLOCK_CNT,
		IFNULL(GSM_PS_BLOCK_CNT,0) AS GSM_PS_BLOCK_CNT,
		IFNULL(GSM_CS_CALL_DURATION,0) AS GSM_CS_CALL_DURATION,
		IFNULL(GSM_CALL_SETUP_TIME_SUM,0) AS GSM_CALL_SETUP_TIME_SUM,
		IFNULL(GSM_CALL_SETUP_TIME_CNT,0) AS GSM_CALL_SETUP_TIME_CNT,
		IFNULL(GSM_CS_CALL_SETUP_TIME_SUM,0) AS GSM_CS_CALL_SETUP_TIME_SUM,
		IFNULL(GSM_CS_CALL_SETUP_TIME_CNT,0) AS GSM_CS_CALL_SETUP_TIME_CNT,
		IFNULL(GSM_PS_CALL_SETUP_TIME_SUM,0) AS GSM_PS_CALL_SETUP_TIME_SUM,
		IFNULL(GSM_PS_CALL_SETUP_TIME_CNT,0) AS GSM_PS_CALL_SETUP_TIME_CNT,
		IFNULL(GSM_CS_SETUP_FAILURE_CNT,0) AS GSM_CS_SETUP_FAILURE_CNT,
		IFNULL(GSM_PS_SETUP_FAILURE_CNT,0) AS GSM_PS_SETUP_FAILURE_CNT,
		IFNULL(UMTS_CS_CALL_CNT,0) AS UMTS_CS_CALL_CNT,
		IFNULL(UMTS_PS_CALL_CNT,0) AS UMTS_PS_CALL_CNT,
		IFNULL(UMTS_VOICE_DROP_CNT,0) AS UMTS_VOICE_DROP_CNT,
		IFNULL(UMTS_PS_DROP_CNT,0) AS UMTS_PS_DROP_CNT,
		IFNULL(UMTS_CS_CALL_DURATION,0) AS UMTS_CS_CALL_DURATION,
		IFNULL(UMTS_CS_BLOCK_CNT,0) AS UMTS_CS_BLOCK_CNT,
		IFNULL(UMTS_PS_BLOCK_CNT,0) AS UMTS_PS_BLOCK_CNT,
		IFNULL(UMTS_UL_VOLUME,0) AS UMTS_UL_VOLUME,
		IFNULL(UMTS_DL_VOLUME,0) AS UMTS_DL_VOLUME,
		IFNULL(UMTS_UL_THROUPUT_SUM,0) AS UMTS_UL_THROUPUT_SUM,
		IFNULL(UMTS_UL_THROUPUT_CNT,0) AS UMTS_UL_THROUPUT_CNT,
		IFNULL(UMTS_DL_THROUPUT_SUM,0) AS UMTS_DL_THROUPUT_SUM,
		IFNULL(UMTS_DL_THROUPUT_CNT,0) AS UMTS_DL_THROUPUT_CNT,
		IFNULL(UMTS_CALL_SETUP_TIME_SUM,0) AS UMTS_CALL_SETUP_TIME_SUM,
		IFNULL(UMTS_CALL_SETUP_TIME_CNT,0) AS UMTS_CALL_SETUP_TIME_CNT,
		IFNULL(`UMTS_CS_CALL_SETUP_TIME_SUM`,0) AS `UMTS_CS_CALL_SETUP_TIME_SUM`, 
		IFNULL(`UMTS_CS_CALL_SETUP_TIME_CNT`,0) AS `UMTS_CS_CALL_SETUP_TIME_CNT`, 
		IFNULL(`UMTS_PS_CALL_SETUP_TIME_SUM`,0) AS `UMTS_PS_CALL_SETUP_TIME_SUM`, 
		IFNULL(`UMTS_PS_CALL_SETUP_TIME_CNT`,0) AS `UMTS_PS_CALL_SETUP_TIME_CNT`, 
		IFNULL(UMTS_CS_SETUP_FAILURE_CNT,0) AS UMTS_CS_SETUP_FAILURE_CNT,
		IFNULL(UMTS_PS_SETUP_FAILURE_CNT,0) AS UMTS_PS_SETUP_FAILURE_CNT,
		IFNULL(UMTS_IRAT_HO_ATMP,0) AS UMTS_IRAT_HO_ATMP,
		IFNULL(UMTS_IRAT_HO_FAIL,0) AS UMTS_IRAT_HO_FAIL,
		IFNULL(LTE_CALL_CNT,0) AS LTE_CALL_CNT,
		IFNULL(LTE_DROP_CNT,0) AS LTE_DROP_CNT,
		IFNULL(LTE_BLOCK_CNT,0) AS LTE_BLOCK_CNT,
		IFNULL(LTE_UL_VOLUME,0) AS LTE_UL_VOLUME,
		IFNULL(LTE_DL_VOLUME,0) AS LTE_DL_VOLUME,
		IFNULL(LTE_UL_THROUPUT_SUM,0) AS LTE_UL_THROUPUT_SUM,
		IFNULL(LTE_UL_THROUPUT_CNT,0) AS LTE_UL_THROUPUT_CNT,
		IFNULL(LTE_DL_THROUPUT_SUM,0) AS LTE_DL_THROUPUT_SUM,
		IFNULL(LTE_DL_THROUPUT_CNT,0) AS LTE_DL_THROUPUT_CNT,
		IFNULL(LATENCY_SUM,0) AS LATENCY_SUM,
		IFNULL(LATENCY_CNT,0) AS LATENCY_CNT,
		IFNULL(LTE_CALL_SETUP_TIME_SUM,0) AS LTE_CALL_SETUP_TIME_SUM,
		IFNULL(LTE_CALL_SETUP_TIME_CNT,0) AS LTE_CALL_SETUP_TIME_CNT,
		IFNULL(LTE_SETUP_FAILURE_CNT,0) AS LTE_SETUP_FAILURE_CNT,
		IFNULL(SRVCC_ATTEMPT_CNT,0) AS SRVCC_ATTEMPT_CNT,
		IFNULL(SRVCC_FAILURE_CNT,0) AS SRVCC_FAILURE_CNT,
		IFNULL(S1_HO_ATTEMPT,0) AS S1_HO_ATTEMPT,
		IFNULL(S1_HO_FAILURE,0) AS S1_HO_FAILURE,
		IFNULL(X2_HO_ATTEMPT,0) AS X2_HO_ATTEMPT,
		IFNULL(X2_HO_FAILURE,0) AS X2_HO_FAILURE,
		IFNULL(UMTS_MAX_UL_THROUPUT,0) AS UMTS_MAX_UL_THROUPUT,
		IFNULL(UMTS_MAX_DL_THROUPUT,0) AS UMTS_MAX_DL_THROUPUT,
		IFNULL(LTE_MAX_UL_THROUPUT,0) AS LTE_MAX_UL_THROUPUT,
		IFNULL(LTE_MAX_DL_THROUPUT,0) AS LTE_MAX_DL_THROUPUT,
		IFNULL(LTE_IRAT_TO_UMTS_ATMP,0) AS LTE_IRAT_TO_UMTS_ATMP,
		IFNULL(LTE_IRAT_TO_GERAN_ATMP,0) AS LTE_IRAT_TO_GERAN_ATMP,
		IFNULL(LTE_IRAT_TO_CDMA_ATMP,0) AS LTE_IRAT_TO_CDMA_ATMP,
		IFNULL(LTE_IRAT_TO_UMTS_FAIL,0) AS LTE_IRAT_TO_UMTS_FAIL,
		IFNULL(LTE_IRAT_TO_GERAN_FAIL,0) AS LTE_IRAT_TO_GERAN_FAIL,
		IFNULL(LTE_IRAT_TO_CDMA_FAIL,0) AS LTE_IRAT_TO_CDMA_FAIL';
		
	DECLARE TILE_DS_COLUMN_SUM_STR VARCHAR(6000) DEFAULT 
		'SUM(IFNULL(RSRP_SUM,0)) AS RSRP_SUM,
		SUM(IFNULL(RSRP_CNT,0)) AS RSRP_CNT,
		SUM(IFNULL(RSCP_SUM,0)) AS RSCP_SUM,
		SUM(IFNULL(RSCP_CNT,0)) AS RSCP_CNT,
		SUM(IFNULL(RXLEV_SUM,0)) AS RXLEV_SUM,
		SUM(IFNULL(RXLEV_CNT,0)) AS RXLEV_CNT,
		SUM(IFNULL(RSRQ_SUM,0)) AS RSRQ_SUM,
		SUM(IFNULL(RSRQ_CNT,0)) AS RSRQ_CNT,
		SUM(IFNULL(ECNO_SUM,0)) AS ECNO_SUM,
		SUM(IFNULL(ECNO_CNT,0)) AS ECNO_CNT,
		SUM(IFNULL(RXQUAL_SUM,0)) AS RXQUAL_SUM,
		SUM(IFNULL(RXQUAL_CNT,0)) AS RXQUAL_CNT,
		SUM(IFNULL(GSM_CS_CALL_CNT,0)) AS GSM_CS_CALL_CNT,
		SUM(IFNULL(GSM_PS_CALL_CNT,0)) AS GSM_PS_CALL_CNT,
		SUM(IFNULL(GSM_VOICE_DROP_CNT,0)) AS GSM_VOICE_DROP_CNT,
		SUM(IFNULL(GSM_GPRS_DROP_CNT,0)) AS GSM_GPRS_DROP_CNT,
		SUM(IFNULL(GSM_SMS_DROP_CNT,0)) AS GSM_SMS_DROP_CNT,
		SUM(IFNULL(GSM_CS_BLOCK_CNT,0)) AS GSM_CS_BLOCK_CNT,
		SUM(IFNULL(GSM_PS_BLOCK_CNT,0)) AS GSM_PS_BLOCK_CNT,
		SUM(IFNULL(GSM_CS_CALL_DURATION,0)) AS GSM_CS_CALL_DURATION,
		SUM(IFNULL(GSM_CALL_SETUP_TIME_SUM,0)) AS GSM_CALL_SETUP_TIME_SUM,
		SUM(IFNULL(GSM_CALL_SETUP_TIME_CNT,0)) AS GSM_CALL_SETUP_TIME_CNT,
		SUM(IFNULL(GSM_CS_CALL_SETUP_TIME_SUM,0)) AS GSM_CS_CALL_SETUP_TIME_SUM,
		SUM(IFNULL(GSM_CS_CALL_SETUP_TIME_SUM,0)) AS GSM_CS_CALL_SETUP_TIME_SUM,
		SUM(IFNULL(GSM_PS_CALL_SETUP_TIME_SUM,0)) AS GSM_PS_CALL_SETUP_TIME_SUM,
		SUM(IFNULL(GSM_PS_CALL_SETUP_TIME_SUM,0)) AS GSM_PS_CALL_SETUP_TIME_SUM,
		SUM(IFNULL(GSM_CS_SETUP_FAILURE_CNT,0)) AS GSM_CS_SETUP_FAILURE_CNT,
		SUM(IFNULL(GSM_PS_SETUP_FAILURE_CNT,0)) AS GSM_PS_SETUP_FAILURE_CNT,
		SUM(IFNULL(UMTS_CS_CALL_CNT,0)) AS UMTS_CS_CALL_CNT,
		SUM(IFNULL(UMTS_PS_CALL_CNT,0)) AS UMTS_PS_CALL_CNT,
		SUM(IFNULL(UMTS_VOICE_DROP_CNT,0)) AS UMTS_VOICE_DROP_CNT,
		SUM(IFNULL(UMTS_PS_DROP_CNT,0)) AS UMTS_PS_DROP_CNT,
		SUM(IFNULL(UMTS_CS_CALL_DURATION,0)) AS UMTS_CS_CALL_DURATION,
		SUM(IFNULL(UMTS_CS_BLOCK_CNT,0)) AS UMTS_CS_BLOCK_CNT,
		SUM(IFNULL(UMTS_PS_BLOCK_CNT,0)) AS UMTS_PS_BLOCK_CNT,
		SUM(IFNULL(UMTS_UL_VOLUME,0)) AS UMTS_UL_VOLUME,
		SUM(IFNULL(UMTS_DL_VOLUME,0)) AS UMTS_DL_VOLUME,
		SUM(IFNULL(UMTS_UL_THROUPUT_SUM,0)) AS UMTS_UL_THROUPUT_SUM,
		SUM(IFNULL(UMTS_UL_THROUPUT_CNT,0)) AS UMTS_UL_THROUPUT_CNT,
		SUM(IFNULL(UMTS_DL_THROUPUT_SUM,0)) AS UMTS_DL_THROUPUT_SUM,
		SUM(IFNULL(UMTS_DL_THROUPUT_CNT,0)) AS UMTS_DL_THROUPUT_CNT,
		SUM(IFNULL(UMTS_CALL_SETUP_TIME_SUM,0)) AS UMTS_CALL_SETUP_TIME_SUM,
		SUM(IFNULL(UMTS_CALL_SETUP_TIME_CNT,0)) AS UMTS_CALL_SETUP_TIME_CNT,
		SUM(IFNULL(`UMTS_CS_CALL_SETUP_TIME_SUM`,0)) AS `UMTS_CS_CALL_SETUP_TIME_SUM`,
		SUM(IFNULL(`UMTS_CS_CALL_SETUP_TIME_CNT`,0)) AS `UMTS_CS_CALL_SETUP_TIME_CNT`,
		SUM(IFNULL(`UMTS_PS_CALL_SETUP_TIME_SUM`,0)) AS `UMTS_PS_CALL_SETUP_TIME_SUM`,
		SUM(IFNULL(`UMTS_PS_CALL_SETUP_TIME_CNT`,0)) AS `UMTS_PS_CALL_SETUP_TIME_CNT`,
		SUM(IFNULL(UMTS_CS_SETUP_FAILURE_CNT,0)) AS UMTS_CS_SETUP_FAILURE_CNT,
		SUM(IFNULL(UMTS_PS_SETUP_FAILURE_CNT,0)) AS UMTS_PS_SETUP_FAILURE_CNT,
	
		SUM(IFNULL(UMTS_IRAT_HO_ATMP,0)) AS UMTS_IRAT_HO_ATMP,
		SUM(IFNULL(UMTS_IRAT_HO_FAIL,0)) AS UMTS_IRAT_HO_FAIL,
	
		SUM(IFNULL(LTE_CALL_CNT,0)) AS LTE_CALL_CNT,
		SUM(IFNULL(LTE_DROP_CNT,0)) AS LTE_DROP_CNT,
		SUM(IFNULL(LTE_BLOCK_CNT,0)) AS LTE_BLOCK_CNT,
		SUM(IFNULL(LTE_UL_VOLUME,0)) AS LTE_UL_VOLUME,
		SUM(IFNULL(LTE_DL_VOLUME,0)) AS LTE_DL_VOLUME,
		SUM(IFNULL(LTE_UL_THROUPUT_SUM,0)) AS LTE_UL_THROUPUT_SUM,
		SUM(IFNULL(LTE_UL_THROUPUT_CNT,0)) AS LTE_UL_THROUPUT_CNT,
		SUM(IFNULL(LTE_DL_THROUPUT_SUM,0)) AS LTE_DL_THROUPUT_SUM,
		SUM(IFNULL(LTE_DL_THROUPUT_CNT,0)) AS LTE_DL_THROUPUT_CNT,
		SUM(IFNULL(LATENCY_SUM,0)) AS LATENCY_SUM,
		SUM(IFNULL(LATENCY_CNT,0)) AS LATENCY_CNT,
		SUM(IFNULL(LTE_CALL_SETUP_TIME_SUM,0)) AS LTE_CALL_SETUP_TIME_SUM,
		SUM(IFNULL(LTE_CALL_SETUP_TIME_CNT,0)) AS LTE_CALL_SETUP_TIME_CNT,
		SUM(IFNULL(LTE_SETUP_FAILURE_CNT,0)) AS LTE_SETUP_FAILURE_CNT,
		SUM(IFNULL(SRVCC_ATTEMPT_CNT,0)) AS SRVCC_ATTEMPT_CNT,
		SUM(IFNULL(SRVCC_FAILURE_CNT,0)) AS SRVCC_FAILURE_CNT,
		SUM(IFNULL(S1_HO_ATTEMPT,0)) AS S1_HO_ATTEMPT,
		SUM(IFNULL(S1_HO_FAILURE,0)) AS S1_HO_FAILURE,
		SUM(IFNULL(X2_HO_ATTEMPT,0)) AS X2_HO_ATTEMPT,
		SUM(IFNULL(X2_HO_FAILURE,0)) AS X2_HO_FAILURE,
		MAX(IFNULL(UMTS_MAX_UL_THROUPUT,0)) AS UMTS_MAX_UL_THROUPUT,
		MAX(IFNULL(UMTS_MAX_DL_THROUPUT,0)) AS UMTS_MAX_DL_THROUPUT,
		MAX(IFNULL(LTE_MAX_UL_THROUPUT,0)) AS LTE_MAX_UL_THROUPUT,
		MAX(IFNULL(LTE_MAX_DL_THROUPUT,0)) AS LTE_MAX_DL_THROUPUT,
	
		SUM(IFNULL(LTE_IRAT_TO_UMTS_ATMP,0)) AS LTE_IRAT_TO_UMTS_ATMP,
		SUM(IFNULL(LTE_IRAT_TO_GERAN_ATMP,0)) AS LTE_IRAT_TO_GERAN_ATMP,
		SUM(IFNULL(LTE_IRAT_TO_CDMA_ATMP,0)) AS LTE_IRAT_TO_CDMA_ATMP,
		SUM(IFNULL(LTE_IRAT_TO_UMTS_FAIL,0)) AS LTE_IRAT_TO_UMTS_FAIL,
		SUM(IFNULL(LTE_IRAT_TO_GERAN_FAIL,0)) AS LTE_IRAT_TO_GERAN_FAIL,
		SUM(IFNULL(LTE_IRAT_TO_CDMA_FAIL,0)) AS LTE_IRAT_TO_CDMA_FAIL
	';		
			
	DECLARE COLUMN_UPD_STR VARCHAR(10000) DEFAULT 
		'RPT_TABLE_NAME.RSRP_SUM=RPT_TABLE_NAME.RSRP_SUM+VALUES(RSRP_SUM),
		RPT_TABLE_NAME.RSRP_CNT=RPT_TABLE_NAME.RSRP_CNT+VALUES(RSRP_CNT),
		RPT_TABLE_NAME.RSCP_SUM=RPT_TABLE_NAME.RSCP_SUM+VALUES(RSCP_SUM),
		RPT_TABLE_NAME.RSCP_CNT=RPT_TABLE_NAME.RSCP_CNT+VALUES(RSCP_CNT),
		RPT_TABLE_NAME.RXLEV_SUM=RPT_TABLE_NAME.RXLEV_SUM+VALUES(RXLEV_SUM),
		RPT_TABLE_NAME.RXLEV_CNT=RPT_TABLE_NAME.RXLEV_CNT+VALUES(RXLEV_CNT),
		RPT_TABLE_NAME.RSRQ_SUM=RPT_TABLE_NAME.RSRQ_SUM+VALUES(RSRQ_SUM),
		RPT_TABLE_NAME.RSRQ_CNT=RPT_TABLE_NAME.RSRQ_CNT+VALUES(RSRQ_CNT),
		RPT_TABLE_NAME.ECNO_SUM=RPT_TABLE_NAME.ECNO_SUM+VALUES(ECNO_SUM),
		RPT_TABLE_NAME.ECNO_CNT=RPT_TABLE_NAME.ECNO_CNT+VALUES(ECNO_CNT),
		RPT_TABLE_NAME.RXQUAL_SUM=RPT_TABLE_NAME.RXQUAL_SUM+VALUES(RXQUAL_SUM),
		RPT_TABLE_NAME.RXQUAL_CNT=RPT_TABLE_NAME.RXQUAL_CNT+VALUES(RXQUAL_CNT),
		RPT_TABLE_NAME.GSM_CS_CALL_CNT=RPT_TABLE_NAME.GSM_CS_CALL_CNT+VALUES(GSM_CS_CALL_CNT),
		RPT_TABLE_NAME.GSM_PS_CALL_CNT=RPT_TABLE_NAME.GSM_PS_CALL_CNT+VALUES(GSM_PS_CALL_CNT),
		RPT_TABLE_NAME.GSM_VOICE_DROP_CNT=RPT_TABLE_NAME.GSM_VOICE_DROP_CNT+VALUES(GSM_VOICE_DROP_CNT),
		RPT_TABLE_NAME.GSM_GPRS_DROP_CNT=RPT_TABLE_NAME.GSM_GPRS_DROP_CNT+VALUES(GSM_GPRS_DROP_CNT),
		RPT_TABLE_NAME.GSM_SMS_DROP_CNT=RPT_TABLE_NAME.GSM_SMS_DROP_CNT+VALUES(GSM_SMS_DROP_CNT),
		RPT_TABLE_NAME.GSM_CS_BLOCK_CNT=RPT_TABLE_NAME.GSM_CS_BLOCK_CNT+VALUES(GSM_CS_BLOCK_CNT),
		RPT_TABLE_NAME.GSM_PS_BLOCK_CNT=RPT_TABLE_NAME.GSM_PS_BLOCK_CNT+VALUES(GSM_PS_BLOCK_CNT),
		RPT_TABLE_NAME.GSM_CS_CALL_DURATION=RPT_TABLE_NAME.GSM_CS_CALL_DURATION+VALUES(GSM_CS_CALL_DURATION),
		RPT_TABLE_NAME.GSM_CALL_SETUP_TIME_SUM=RPT_TABLE_NAME.GSM_CALL_SETUP_TIME_SUM+VALUES(GSM_CALL_SETUP_TIME_SUM),
		RPT_TABLE_NAME.GSM_CALL_SETUP_TIME_CNT=RPT_TABLE_NAME.GSM_CALL_SETUP_TIME_CNT+VALUES(GSM_CALL_SETUP_TIME_CNT),
	
		RPT_TABLE_NAME.GSM_CS_CALL_SETUP_TIME_SUM=RPT_TABLE_NAME.GSM_CS_CALL_SETUP_TIME_SUM+VALUES(GSM_CS_CALL_SETUP_TIME_SUM),
		RPT_TABLE_NAME.GSM_CS_CALL_SETUP_TIME_CNT=RPT_TABLE_NAME.GSM_CS_CALL_SETUP_TIME_CNT+VALUES(GSM_CS_CALL_SETUP_TIME_CNT),
		RPT_TABLE_NAME.GSM_PS_CALL_SETUP_TIME_SUM=RPT_TABLE_NAME.GSM_PS_CALL_SETUP_TIME_SUM+VALUES(GSM_PS_CALL_SETUP_TIME_SUM),
		RPT_TABLE_NAME.GSM_PS_CALL_SETUP_TIME_CNT=RPT_TABLE_NAME.GSM_PS_CALL_SETUP_TIME_CNT+VALUES(GSM_PS_CALL_SETUP_TIME_CNT),
	
		RPT_TABLE_NAME.GSM_CS_SETUP_FAILURE_CNT=RPT_TABLE_NAME.GSM_CS_SETUP_FAILURE_CNT+VALUES(GSM_CS_SETUP_FAILURE_CNT),
		RPT_TABLE_NAME.GSM_PS_SETUP_FAILURE_CNT=RPT_TABLE_NAME.GSM_PS_SETUP_FAILURE_CNT+VALUES(GSM_PS_SETUP_FAILURE_CNT),
		RPT_TABLE_NAME.UMTS_CS_CALL_CNT=RPT_TABLE_NAME.UMTS_CS_CALL_CNT+VALUES(UMTS_CS_CALL_CNT),
		RPT_TABLE_NAME.UMTS_PS_CALL_CNT=RPT_TABLE_NAME.UMTS_PS_CALL_CNT+VALUES(UMTS_PS_CALL_CNT),
		RPT_TABLE_NAME.UMTS_VOICE_DROP_CNT=RPT_TABLE_NAME.UMTS_VOICE_DROP_CNT+VALUES(UMTS_VOICE_DROP_CNT),
		RPT_TABLE_NAME.UMTS_PS_DROP_CNT=RPT_TABLE_NAME.UMTS_PS_DROP_CNT+VALUES(UMTS_PS_DROP_CNT),
		RPT_TABLE_NAME.UMTS_CS_CALL_DURATION=RPT_TABLE_NAME.UMTS_CS_CALL_DURATION+VALUES(UMTS_CS_CALL_DURATION),
		RPT_TABLE_NAME.UMTS_CS_BLOCK_CNT=RPT_TABLE_NAME.UMTS_CS_BLOCK_CNT+VALUES(UMTS_CS_BLOCK_CNT),
		RPT_TABLE_NAME.UMTS_PS_BLOCK_CNT=RPT_TABLE_NAME.UMTS_PS_BLOCK_CNT+VALUES(UMTS_PS_BLOCK_CNT),
		RPT_TABLE_NAME.UMTS_UL_VOLUME=RPT_TABLE_NAME.UMTS_UL_VOLUME+VALUES(UMTS_UL_VOLUME),
		RPT_TABLE_NAME.UMTS_DL_VOLUME=RPT_TABLE_NAME.UMTS_DL_VOLUME+VALUES(UMTS_DL_VOLUME),
		RPT_TABLE_NAME.UMTS_UL_THROUPUT_SUM=RPT_TABLE_NAME.UMTS_UL_THROUPUT_SUM+VALUES(UMTS_UL_THROUPUT_SUM),
		RPT_TABLE_NAME.UMTS_UL_THROUPUT_CNT=RPT_TABLE_NAME.UMTS_UL_THROUPUT_CNT+VALUES(UMTS_UL_THROUPUT_CNT),
		RPT_TABLE_NAME.UMTS_DL_THROUPUT_SUM=RPT_TABLE_NAME.UMTS_DL_THROUPUT_SUM+VALUES(UMTS_DL_THROUPUT_SUM),
		RPT_TABLE_NAME.UMTS_DL_THROUPUT_CNT=RPT_TABLE_NAME.UMTS_DL_THROUPUT_CNT+VALUES(UMTS_DL_THROUPUT_CNT),
		RPT_TABLE_NAME.UMTS_CALL_SETUP_TIME_SUM=RPT_TABLE_NAME.UMTS_CALL_SETUP_TIME_SUM+VALUES(UMTS_CALL_SETUP_TIME_SUM),
		RPT_TABLE_NAME.UMTS_CALL_SETUP_TIME_CNT=RPT_TABLE_NAME.UMTS_CALL_SETUP_TIME_CNT+VALUES(UMTS_CALL_SETUP_TIME_CNT),
		
		RPT_TABLE_NAME.UMTS_CS_CALL_SETUP_TIME_SUM=RPT_TABLE_NAME.UMTS_CS_CALL_SETUP_TIME_SUM+VALUES(UMTS_CS_CALL_SETUP_TIME_SUM),
		RPT_TABLE_NAME.UMTS_CS_CALL_SETUP_TIME_CNT=RPT_TABLE_NAME.UMTS_CS_CALL_SETUP_TIME_CNT+VALUES(UMTS_CS_CALL_SETUP_TIME_CNT),
		RPT_TABLE_NAME.UMTS_PS_CALL_SETUP_TIME_SUM=RPT_TABLE_NAME.UMTS_PS_CALL_SETUP_TIME_SUM+VALUES(UMTS_PS_CALL_SETUP_TIME_SUM),
		RPT_TABLE_NAME.UMTS_PS_CALL_SETUP_TIME_CNT=RPT_TABLE_NAME.UMTS_PS_CALL_SETUP_TIME_CNT+VALUES(UMTS_PS_CALL_SETUP_TIME_CNT),
	
	
		RPT_TABLE_NAME.UMTS_CS_SETUP_FAILURE_CNT=RPT_TABLE_NAME.UMTS_CS_SETUP_FAILURE_CNT+VALUES(UMTS_CS_SETUP_FAILURE_CNT),
		RPT_TABLE_NAME.UMTS_PS_SETUP_FAILURE_CNT=RPT_TABLE_NAME.UMTS_PS_SETUP_FAILURE_CNT+VALUES(UMTS_PS_SETUP_FAILURE_CNT),
	
		RPT_TABLE_NAME.UMTS_IRAT_HO_ATMP=RPT_TABLE_NAME.UMTS_IRAT_HO_ATMP+VALUES(UMTS_IRAT_HO_ATMP),
		RPT_TABLE_NAME.UMTS_IRAT_HO_FAIL=RPT_TABLE_NAME.UMTS_IRAT_HO_FAIL+VALUES(UMTS_IRAT_HO_FAIL),
		
		RPT_TABLE_NAME.LTE_CALL_CNT=RPT_TABLE_NAME.LTE_CALL_CNT+VALUES(LTE_CALL_CNT),
		RPT_TABLE_NAME.LTE_DROP_CNT=RPT_TABLE_NAME.LTE_DROP_CNT+VALUES(LTE_DROP_CNT),
		RPT_TABLE_NAME.LTE_BLOCK_CNT=RPT_TABLE_NAME.LTE_BLOCK_CNT+VALUES(LTE_BLOCK_CNT),
		RPT_TABLE_NAME.LTE_UL_VOLUME=RPT_TABLE_NAME.LTE_UL_VOLUME+VALUES(LTE_UL_VOLUME),
		RPT_TABLE_NAME.LTE_DL_VOLUME=RPT_TABLE_NAME.LTE_DL_VOLUME+VALUES(LTE_DL_VOLUME),
		RPT_TABLE_NAME.LTE_UL_THROUPUT_SUM=RPT_TABLE_NAME.LTE_UL_THROUPUT_SUM+VALUES(LTE_UL_THROUPUT_SUM),
		RPT_TABLE_NAME.LTE_UL_THROUPUT_CNT=RPT_TABLE_NAME.LTE_UL_THROUPUT_CNT+VALUES(LTE_UL_THROUPUT_CNT),
		RPT_TABLE_NAME.LTE_DL_THROUPUT_SUM=RPT_TABLE_NAME.LTE_DL_THROUPUT_SUM+VALUES(LTE_DL_THROUPUT_SUM),
		RPT_TABLE_NAME.LTE_DL_THROUPUT_CNT=RPT_TABLE_NAME.LTE_DL_THROUPUT_CNT+VALUES(LTE_DL_THROUPUT_CNT),
		RPT_TABLE_NAME.LATENCY_SUM=RPT_TABLE_NAME.LATENCY_SUM+VALUES(LATENCY_SUM),
		RPT_TABLE_NAME.LATENCY_CNT=RPT_TABLE_NAME.LATENCY_CNT+VALUES(LATENCY_CNT),
		RPT_TABLE_NAME.LTE_CALL_SETUP_TIME_SUM=RPT_TABLE_NAME.LTE_CALL_SETUP_TIME_SUM+VALUES(LTE_CALL_SETUP_TIME_SUM),
		RPT_TABLE_NAME.LTE_CALL_SETUP_TIME_CNT=RPT_TABLE_NAME.LTE_CALL_SETUP_TIME_CNT+VALUES(LTE_CALL_SETUP_TIME_CNT),
		RPT_TABLE_NAME.LTE_SETUP_FAILURE_CNT=RPT_TABLE_NAME.LTE_SETUP_FAILURE_CNT+VALUES(LTE_SETUP_FAILURE_CNT),
		RPT_TABLE_NAME.SRVCC_ATTEMPT_CNT=RPT_TABLE_NAME.SRVCC_ATTEMPT_CNT+VALUES(SRVCC_ATTEMPT_CNT),
		RPT_TABLE_NAME.SRVCC_FAILURE_CNT=RPT_TABLE_NAME.SRVCC_FAILURE_CNT+VALUES(SRVCC_FAILURE_CNT),
		RPT_TABLE_NAME.S1_HO_ATTEMPT=RPT_TABLE_NAME.S1_HO_ATTEMPT+VALUES(S1_HO_ATTEMPT),
		RPT_TABLE_NAME.S1_HO_FAILURE=RPT_TABLE_NAME.S1_HO_FAILURE+VALUES(S1_HO_FAILURE),
		RPT_TABLE_NAME.X2_HO_ATTEMPT=RPT_TABLE_NAME.X2_HO_ATTEMPT+VALUES(X2_HO_ATTEMPT),
		RPT_TABLE_NAME.X2_HO_FAILURE=RPT_TABLE_NAME.X2_HO_FAILURE+VALUES(X2_HO_FAILURE),
		RPT_TABLE_NAME.UMTS_MAX_UL_THROUPUT=CASE WHEN RPT_TABLE_NAME.UMTS_MAX_UL_THROUPUT > VALUES(UMTS_MAX_UL_THROUPUT) THEN RPT_TABLE_NAME.UMTS_MAX_UL_THROUPUT ELSE VALUES(UMTS_MAX_UL_THROUPUT) END,    
		RPT_TABLE_NAME.UMTS_MAX_DL_THROUPUT=CASE WHEN RPT_TABLE_NAME.UMTS_MAX_DL_THROUPUT > VALUES(UMTS_MAX_DL_THROUPUT) THEN RPT_TABLE_NAME.UMTS_MAX_DL_THROUPUT ELSE VALUES(UMTS_MAX_DL_THROUPUT) END,
		RPT_TABLE_NAME.LTE_MAX_UL_THROUPUT=CASE WHEN RPT_TABLE_NAME.LTE_MAX_UL_THROUPUT > VALUES(LTE_MAX_UL_THROUPUT) THEN RPT_TABLE_NAME.LTE_MAX_UL_THROUPUT ELSE VALUES(LTE_MAX_UL_THROUPUT) END,    
		RPT_TABLE_NAME.LTE_MAX_DL_THROUPUT=CASE WHEN RPT_TABLE_NAME.LTE_MAX_DL_THROUPUT > VALUES(LTE_MAX_DL_THROUPUT) THEN RPT_TABLE_NAME.LTE_MAX_DL_THROUPUT ELSE VALUES(LTE_MAX_DL_THROUPUT) END,
		
		RPT_TABLE_NAME.LTE_IRAT_TO_UMTS_ATMP=RPT_TABLE_NAME.LTE_IRAT_TO_UMTS_ATMP+VALUES(LTE_IRAT_TO_UMTS_ATMP),
		RPT_TABLE_NAME.LTE_IRAT_TO_GERAN_ATMP=RPT_TABLE_NAME.LTE_IRAT_TO_GERAN_ATMP+VALUES(LTE_IRAT_TO_GERAN_ATMP),
		RPT_TABLE_NAME.LTE_IRAT_TO_CDMA_ATMP=RPT_TABLE_NAME.LTE_IRAT_TO_CDMA_ATMP+VALUES(LTE_IRAT_TO_CDMA_ATMP),
		RPT_TABLE_NAME.LTE_IRAT_TO_UMTS_FAIL=RPT_TABLE_NAME.LTE_IRAT_TO_UMTS_FAIL+VALUES(LTE_IRAT_TO_UMTS_FAIL),
		RPT_TABLE_NAME.LTE_IRAT_TO_GERAN_FAIL=RPT_TABLE_NAME.LTE_IRAT_TO_GERAN_FAIL+VALUES(LTE_IRAT_TO_GERAN_FAIL),
		RPT_TABLE_NAME.LTE_IRAT_TO_CDMA_FAIL=RPT_TABLE_NAME.LTE_IRAT_TO_CDMA_FAIL+VALUES(LTE_IRAT_TO_CDMA_FAIL)
	';
	
	DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
	BEGIN
		SET @SqlCmd=CONCAT('CREATE TABLE IF NOT EXISTS `gt_global_statistic`.`nw_error_log`
				(
				  `TABLE_NAME` VARCHAR(50) NOT NULL,
				  `SP_NAME` VARCHAR(50) DEFAULT NULL,
				  `INSERT_CMD` VARCHAR(100) DEFAULT NULL,
				  `INSERT_TIME` DATETIME DEFAULT NULL
				) ENGINE=MYISAM;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		INSERT INTO `gt_global_statistic`.`nw_error_log`(`TABLE_NAME`,`SP_NAME`,`INSERT_CMD`,`INSERT_TIME`)
		VALUES (@SOURCE_TABLE_NAME,
			'SP_Generate_Global_Statistic_DS_Aggr',
			CONCAT('Step ',@ERROR_FLAG,' error'),
			NOW());
	
		SET @SqlCmd=CONCAT('REPAIR TABLE ',@REPAIR_TABLE_NAME,';');				
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	END;	
	
	SET SESSION max_heap_table_size=8*1024*1024*1024;
	SET SESSION tmp_table_size=8*1024*1024*1024;	
	SET SESSION read_buffer_size=2*1024*1024*1024;
	SET SESSION group_concat_max_len=102400; 
	
	SET @global_db='gt_global_statistic';
	SET @ZOOM_LEVEL3 = gt_covmo_csv_get(TileResolution,3);
	SET @ZOOM_LEVEL2 = gt_covmo_csv_get(TileResolution,2);
	SET @ZOOM_LEVEL1 = gt_covmo_csv_get(TileResolution,1);
	SET @TILE_ID_LVL1 = CONCAT('TILE_ID_',gt_covmo_csv_get(TileResolution,1));
	SET @TILE_ID_LVL2 = CONCAT('TILE_ID_',gt_covmo_csv_get(TileResolution,2));
	
	SET @FLAG_TILE_19_DS_HR=0;
	SET @FLAG_TILE_16_DS_HR=0;
	SET @FLAG_TILE_13_DS_HR=0;
	SET @FLAG_REG_3_DS_HR=0;
	SET @FLAG_REG_2_DS_HR=0;
	SET @FLAG_REG_1_DS_HR=0;
	
	SET @FLAG_TILE_19_DS_DY=0;
	SET @FLAG_TILE_16_DS_DY=0;
	SET @FLAG_TILE_13_DS_DY=0;
	SET @FLAG_REG_3_DS_DY=0;
	SET @FLAG_REG_2_DS_DY=0;
	SET @FLAG_REG_1_DS_DY=0;
	
	INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr','START', START_TIME);
	SET STEP_START_TIME := SYSDATE();
	
	SET @SqlCmd=CONCAT('SELECT GROUP_CONCAT(DISTINCT CONCAT(`DATA_DATE`,'','',`DATA_HOUR`) SEPARATOR ''|'' ),
				SUM(IF(TECH_MASK=1,1,0)),SUM(IF(TECH_MASK=2,1,0)),SUM(IF(TECH_MASK=4,1,0)) INTO @PU_STR,@GSM_CNT,@UMTS_CNT,@LTE_CNT
				FROM gt_global_statistic.table_running_task_ds 
				GROUP BY `DATA_DATE`,`DATA_HOUR`
				;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	SET v_DATA_DATE:=gt_covmo_csv_get(@PU_STR,1);		
	SET v_DATA_HOUR:=gt_covmo_csv_get(@PU_STR,2);
	SELECT `DAY_OF_WEEK`(v_DATA_DATE) INTO @DAY_OF_WEEK;
	SET @FIRST_DAY=gt_strtok(@DAY_OF_WEEK, 1, '|');
	SET @END_DAY=gt_strtok(@DAY_OF_WEEK, 2, '|');
	SET @DATE_WK=CONCAT(DATE_FORMAT(@FIRST_DAY,'%Y%m%d'),'_',DATE_FORMAT(@END_DAY,'%Y%m%d'));
	SET @DATE_MN=DATE_FORMAT(v_DATA_DATE,'%Y%m');
	SET @DATE_DY=DATE_FORMAT(v_DATA_DATE,'%Y%m%d');
	SET @EX_DATE=CONCAT(DATE_FORMAT(v_DATA_DATE,'%Y%m%d_'),v_DATA_HOUR,'_',WORKER_ID);
	
		
	SET @SqlCmd=CONCAT('SELECT GROUP_CONCAT(DISTINCT `group_id` ORDER BY `group_id` SEPARATOR ''|'' ) INTO @REG_GROUP FROM ',@global_db,'.`usr_polygon_reg_3`;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;		
		
	SET @v_reg_m=1;
	SET @v_reg_Max=gt_covmo_csv_count(@REG_GROUP,'|');
	WHILE @v_reg_m <= @v_reg_Max DO
	BEGIN
		SET v_group_db_name=CONCAT('gt_global_statistic_g',gt_strtok(@REG_GROUP, @v_reg_m, '|'));
					
		SET @tmp_tile_ds_umts_hr=CONCAT(v_group_db_name,'.tmp_ds_tile_umts_agg_',@EX_DATE);
		SET @tmp_tile_ds_lte_hr=CONCAT(v_group_db_name,'.tmp_ds_tile_lte_agg_',@EX_DATE);
		SET @tmp_tile_ds_gsm_hr=CONCAT(v_group_db_name,'.tmp_ds_tile_gsm_agg_',@EX_DATE);
		
		SET @tmp_tile_ds_hr=CONCAT(v_group_db_name,'.tmp_ds_tile_hr_',@EX_DATE);
		
		SET @table_tile_19_ds_hr=CONCAT(v_group_db_name,'.table_tile_',@ZOOM_LEVEL3,'_ds_hr_',@DATE_DY);
		SET @table_tile_16_ds_hr=CONCAT(v_group_db_name,'.table_tile_',@ZOOM_LEVEL2,'_ds_hr_',@DATE_DY);
		SET @table_tile_13_ds_hr=CONCAT(v_group_db_name,'.table_tile_',@ZOOM_LEVEL1,'_ds_hr_',@DATE_DY);
			
		SET @table_reg_3_ds_hr=CONCAT(v_group_db_name,'.table_reg_3_ds_hr_',@DATE_DY);
		SET @table_reg_2_ds_hr=CONCAT(v_group_db_name,'.table_reg_2_ds_hr_',@DATE_DY);
		SET @table_reg_1_ds_hr=CONCAT(v_group_db_name,'.table_reg_1_ds_hr_',@DATE_DY);
		
		SET @table_tile_19_ds_dy=CONCAT(v_group_db_name,'.table_tile_',@ZOOM_LEVEL3,'_ds_dy_',@DATE_DY);
		SET @table_tile_16_ds_dy=CONCAT(v_group_db_name,'.table_tile_',@ZOOM_LEVEL2,'_ds_dy_',@DATE_DY);
		SET @table_tile_13_ds_dy=CONCAT(v_group_db_name,'.table_tile_',@ZOOM_LEVEL1,'_ds_dy_',@DATE_DY);
			
		SET @table_reg_3_ds_dy=CONCAT(v_group_db_name,'.table_reg_3_ds_dy_',@DATE_DY);
		SET @table_reg_2_ds_dy=CONCAT(v_group_db_name,'.table_reg_2_ds_dy_',@DATE_DY);
		SET @table_reg_1_ds_dy=CONCAT(v_group_db_name,'.table_reg_1_ds_dy_',@DATE_DY);
		
		
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',@tmp_tile_ds_hr,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
				
		SET @SqlCmd=CONCAT('CREATE TABLE ',@tmp_tile_ds_hr,' LIKE ',@table_tile_19_ds_hr,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;	
			
		SET @SOURCE_TABLE_NAME=@tmp_tile_ds_hr;
		SET @ERROR_FLAG='tmp_tile_ds_hr';
		
		SET @SqlCmd=CONCAT('INSERT INTO ',@tmp_tile_ds_hr,' 
				    (
					`TILE_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_STR,',
					',@TILE_ID_LVL2,',
					',@TILE_ID_LVL1,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`)
				SELECT
					`TILE_ID` AS `TILE_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_SUM_STR,',
					',@TILE_ID_LVL2,',
					',@TILE_ID_LVL1,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`
				FROM 
					(
				');	
		IF @UMTS_CNT>0 THEN 
			SET @SqlCmd=CONCAT(@SqlCmd,'SELECT
						`TILE_ID`,
						`DATA_DATE`,
						`DATA_HOUR`,
						',TILE_DS_COLUMN_STR,',
						',@TILE_ID_LVL2,',
						',@TILE_ID_LVL1,',
						`REG_1_ID`,
						`REG_2_ID`,
						`REG_3_ID`
					FROM 
					', @tmp_tile_ds_umts_hr ,'
				');
		END IF;
		IF @LTE_CNT>0 AND @UMTS_CNT>0 THEN 
			SET @SqlCmd=CONCAT(@SqlCmd,'
					UNION
					SELECT
						`TILE_ID`,
						`DATA_DATE`,
						`DATA_HOUR`,
						',TILE_DS_COLUMN_STR,',
						',@TILE_ID_LVL2,',
						',@TILE_ID_LVL1,',
						`REG_1_ID`,
						`REG_2_ID`,
						`REG_3_ID`
					FROM 
					', @tmp_tile_ds_lte_hr ,'
				');
		ELSEIF @LTE_CNT>0 THEN 
			SET @SqlCmd=CONCAT(@SqlCmd,'
					SELECT
						`TILE_ID`,
						`DATA_DATE`,
						`DATA_HOUR`,
						',TILE_DS_COLUMN_STR,',
						',@TILE_ID_LVL2,',
						',@TILE_ID_LVL1,',
						`REG_1_ID`,
						`REG_2_ID`,
						`REG_3_ID`
					FROM 
					', @tmp_tile_ds_lte_hr ,'
				');
		END IF;		
		IF (@GSM_CNT>0 AND @UMTS_CNT>0) OR (@GSM_CNT>0 AND @LTE_CNT>0) THEN 	
			SET @SqlCmd=CONCAT(@SqlCmd,'
					UNION
					SELECT
						`TILE_ID`,
						`DATA_DATE`,
						`DATA_HOUR`,
						',TILE_DS_COLUMN_STR,',
						',@TILE_ID_LVL2,',
						',@TILE_ID_LVL1,',
						`REG_1_ID`,
						`REG_2_ID`,
						`REG_3_ID`
					FROM 
					', @tmp_tile_ds_gsm_hr );
		ELSEIF (@GSM_CNT>0) THEN 	
			SET @SqlCmd=CONCAT(@SqlCmd,'
					SELECT
						`TILE_ID`,
						`DATA_DATE`,
						`DATA_HOUR`,
						',TILE_DS_COLUMN_STR,',
						',@TILE_ID_LVL2,',
						',@TILE_ID_LVL1,',
						`REG_1_ID`,
						`REG_2_ID`,
						`REG_3_ID`
					FROM 
					', @tmp_tile_ds_gsm_hr );
		END IF;				
		SET @SqlCmd=CONCAT(@SqlCmd,'
					) AA
				GROUP BY `TILE_ID`,`DATA_DATE`,`DATA_HOUR`
				ORDER BY NULL;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @SOURCE_TABLE_NAME=@table_tile_19_ds_hr;
		SET @REPAIR_TABLE_NAME=@table_tile_19_ds_hr;
		SET @ERROR_FLAG='table_tile_19_ds_hr';
		
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_tile_19_ds_hr,' 
				    (
					`TILE_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_STR,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`)
				SELECT
					`TILE_ID` AS `TILE_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_IFNULL_STR,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`
				FROM ',@tmp_tile_ds_hr,'
				ON DUPLICATE KEY UPDATE
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_tile_19_ds_hr),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_TILE_19_ds_hr=1;
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_tile_19_ds_hr,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
	
		SET @SOURCE_TABLE_NAME=@table_tile_16_ds_hr;
		SET @REPAIR_TABLE_NAME=@table_tile_16_ds_hr;
		SET @ERROR_FLAG='table_tile_16_ds_hr';
			
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_tile_16_ds_hr,' 
				    (
					`TILE_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_STR,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`)
				SELECT
					',@TILE_ID_LVL2,' AS `TILE_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_SUM_STR,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`
				FROM ',@tmp_tile_ds_hr,'
				GROUP BY ',@TILE_ID_LVL2,',`DATA_DATE`,`DATA_HOUR`
				ORDER BY NULL
				ON DUPLICATE KEY UPDATE 
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_tile_16_ds_hr),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_TILE_16_ds_hr=1;
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_tile_16_ds_hr,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
		
		SET @SOURCE_TABLE_NAME=@table_tile_13_ds_hr;
		SET @REPAIR_TABLE_NAME=@table_tile_13_ds_hr;
		SET @ERROR_FLAG='table_tile_13_ds_hr';
		
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_tile_13_ds_hr,' 
				    (
					`TILE_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_STR,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`)
				SELECT
					`',@TILE_ID_LVL1,'` AS `TILE_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_SUM_STR,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`
				FROM ',@tmp_tile_ds_hr,'
				GROUP BY `',@TILE_ID_LVL1,'`,`DATA_DATE`,`DATA_HOUR`
				ORDER BY NULL
				ON DUPLICATE KEY UPDATE 
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_tile_13_ds_hr),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_TILE_13_ds_hr=1;	
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_tile_13_ds_hr,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
		
		SET @SOURCE_TABLE_NAME=@table_reg_3_ds_hr;
		SET @REPAIR_TABLE_NAME=@table_reg_3_ds_hr;
		SET @ERROR_FLAG='table_reg_3_ds_hr';
	
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_reg_3_ds_hr,' 
				    (
					`REG_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_STR,')
				SELECT
					`REG_3_ID` AS `REG_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_SUM_STR,'
				FROM ',@tmp_tile_ds_hr,'
				GROUP BY `REG_3_ID`,`DATA_DATE`,`DATA_HOUR`
				ORDER BY NULL
				ON DUPLICATE KEY UPDATE 
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_reg_3_ds_hr),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_REG_3_ds_hr=1;
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_reg_3_ds_hr,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
		
		SET @SOURCE_TABLE_NAME=@table_reg_2_ds_hr;
		SET @REPAIR_TABLE_NAME=@table_reg_2_ds_hr;
		SET @ERROR_FLAG='table_reg_2_ds_hr';
	
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_reg_2_ds_hr,' 
				    (
					`REG_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_STR,')
				SELECT
					`REG_2_ID` AS `REG_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_SUM_STR,'
				FROM ',@tmp_tile_ds_hr,'
				GROUP BY `REG_2_ID`,`DATA_DATE`,`DATA_HOUR`
				ORDER BY NULL
				ON DUPLICATE KEY UPDATE 
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_reg_2_ds_hr),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_reg_2_ds_hr=1;
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_reg_2_ds_hr,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
	
		SET @SOURCE_TABLE_NAME=@table_reg_1_ds_hr;
		SET @REPAIR_TABLE_NAME=@table_reg_1_ds_hr;
		SET @ERROR_FLAG='table_reg_1_ds_hr';
		
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_reg_1_ds_hr,' 
				    (
					`REG_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_STR,')
				SELECT
					`REG_1_ID` AS `REG_ID`,
					`DATA_DATE`,
					`DATA_HOUR`,
					',TILE_DS_COLUMN_SUM_STR,'
				FROM ',@tmp_tile_ds_hr,'
				GROUP BY `REG_1_ID`,`DATA_DATE`,`DATA_HOUR`
				ORDER BY NULL
				ON DUPLICATE KEY UPDATE 
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_reg_1_ds_hr),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_reg_1_ds_hr=1;
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_reg_1_ds_hr,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
		
		SET @SOURCE_TABLE_NAME=@table_tile_19_ds_dy;
		SET @REPAIR_TABLE_NAME=@table_tile_19_ds_dy;
		SET @ERROR_FLAG='table_tile_19_ds_dy';
	
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_tile_19_ds_dy,' 
				    (
					`TILE_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_STR,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`)
				SELECT
					`TILE_ID` AS `TILE_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_IFNULL_STR,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`
				FROM ',@tmp_tile_ds_hr,'
				ON DUPLICATE KEY UPDATE
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_tile_19_ds_dy),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_TILE_19_ds_dy=1;
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_tile_19_ds_dy,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
		
		SET @SOURCE_TABLE_NAME=@table_tile_16_ds_dy;
		SET @REPAIR_TABLE_NAME=@table_tile_16_ds_dy;
		SET @ERROR_FLAG='table_tile_16_ds_dy';
	
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_tile_16_ds_dy,' 
				    (
					`TILE_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_STR,',
				`REG_1_ID`,
				`REG_2_ID`,
				`REG_3_ID`)
			SELECT
				',@TILE_ID_LVL2,' AS `TILE_ID`,
				`DATA_DATE`,
				',TILE_DS_COLUMN_SUM_STR,',
				`REG_1_ID`,
				`REG_2_ID`,
				`REG_3_ID`
			FROM ',@tmp_tile_ds_hr,'
			GROUP BY ',@TILE_ID_LVL2,',`DATA_DATE`
			ORDER BY NULL
			ON DUPLICATE KEY UPDATE 
			',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_tile_16_ds_dy),'
			;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_TILE_16_ds_dy=1;
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_tile_16_ds_dy,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();	
		
		SET @SOURCE_TABLE_NAME=@table_tile_13_ds_dy;
		SET @REPAIR_TABLE_NAME=@table_tile_13_ds_dy;
		SET @ERROR_FLAG='table_tile_13_ds_dy';
	
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_tile_13_ds_dy,' 
				    (
					`TILE_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_STR,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`)
				SELECT
					`',@TILE_ID_LVL1,'` AS `TILE_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_SUM_STR,',
					`REG_1_ID`,
					`REG_2_ID`,
					`REG_3_ID`
				FROM ',@tmp_tile_ds_hr,'
				GROUP BY `',@TILE_ID_LVL1,'`,`DATA_DATE`
				ORDER BY NULL
				ON DUPLICATE KEY UPDATE 
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_tile_13_ds_dy),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_TILE_13_ds_dy=1;	
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_tile_13_ds_dy,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
		
		SET @SOURCE_TABLE_NAME=@table_reg_3_ds_dy;
		SET @REPAIR_TABLE_NAME=@table_reg_3_ds_dy;
		SET @ERROR_FLAG='table_reg_3_ds_dy';
	
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_reg_3_ds_dy,' 
				    (
					`REG_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_STR,')
				SELECT
					`REG_3_ID` AS `REG_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_SUM_STR,'
				FROM ',@tmp_tile_ds_hr,'
				GROUP BY `REG_3_ID`,`DATA_DATE`
				ORDER BY NULL
				ON DUPLICATE KEY UPDATE 
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_reg_3_ds_dy),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_REG_3_ds_dy=1;
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_reg_3_ds_dy,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
		
		SET @SOURCE_TABLE_NAME=@table_reg_2_ds_dy;
		SET @REPAIR_TABLE_NAME=@table_reg_2_ds_dy;
		SET @ERROR_FLAG='table_reg_2_ds_dy';
	
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_reg_2_ds_dy,' 
				    (
					`REG_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_STR,')
				SELECT
					`REG_2_ID` AS `REG_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_SUM_STR,'
				FROM ',@tmp_tile_ds_hr,'
				GROUP BY `REG_2_ID`,`DATA_DATE`
				ORDER BY NULL
				ON DUPLICATE KEY UPDATE 
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_reg_2_ds_dy),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_reg_2_ds_dy=1;
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_reg_2_ds_dy,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
	
		SET @SOURCE_TABLE_NAME=@table_reg_1_ds_dy;
		SET @REPAIR_TABLE_NAME=@table_reg_1_ds_dy;
		SET @ERROR_FLAG='table_reg_1_ds_dy';
		
		SET @SqlCmd=CONCAT('INSERT INTO ',@table_reg_1_ds_dy,' 
				    (
					`REG_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_STR,')
				SELECT
					`REG_1_ID` AS `REG_ID`,
					`DATA_DATE`,
					',TILE_DS_COLUMN_SUM_STR,'
				FROM ',@tmp_tile_ds_hr,'
				GROUP BY `REG_1_ID`,`DATA_DATE`
				ORDER BY NULL
				ON DUPLICATE KEY UPDATE 
				',REPLACE(COLUMN_UPD_STR,'RPT_TABLE_NAME',@table_reg_1_ds_dy),'
				;');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		
		SET @FLAG_reg_1_ds_dy=1;
		INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT('INSERT INTO ',@table_reg_1_ds_dy,' cost:',TIMESTAMPDIFF(SECOND,STEP_START_TIME,SYSDATE()),' sec.'), NOW());
		SET STEP_START_TIME := SYSDATE();
		
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',@tmp_tile_ds_hr,';');					
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',@tmp_tile_ds_umts_hr,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',@tmp_tile_ds_lte_hr,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		SET @SqlCmd=CONCAT('DROP TABLE IF EXISTS ',@tmp_tile_ds_gsm_hr,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
		SET @v_reg_m=@v_reg_m+1;
	END;
	END WHILE;
	
	SET SESSION max_heap_table_size=512*1024*1024;
	SET SESSION tmp_table_size=512*1024*1024;	
	SET SESSION read_buffer_size=512*1024*1024;
	
	INSERT INTO gt_gw_main.SP_LOG VALUES('gt_global_statistic','SP_Generate_Global_Statistic_DS_Aggr',CONCAT(v_DATA_DATE,',',v_DATA_HOUR,',',WORKER_ID,' Done: ',TIMESTAMPDIFF(SECOND,START_TIME,SYSDATE()),' seconds.'), NOW());
