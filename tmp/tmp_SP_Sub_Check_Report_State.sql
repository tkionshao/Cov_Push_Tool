CREATE DEFINER=`covmo`@`%` PROCEDURE `SP_Sub_Check_Report_State`(IN GT_DB VARCHAR(100), IN JOB_ID INT)
BEGIN
	SET @SqlCmd=CONCAT('SELECT COUNT(*) INTO @C_CNT FROM ',GT_DB,'.report_process_state
			WHERE J_STATUS = 0 AND JOB_ID = ',JOB_ID,';');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	
	IF @C_CNT > 0 THEN
		SET @SqlCmd=CONCAT('SELECT GROUP_CONCAT(J_ERR_MSG) INTO @J_ERR_MSG FROM ',GT_DB,'.report_process_state
				WHERE J_STATUS = 0 AND JOB_ID = ',JOB_ID,';');
		PREPARE Stmt FROM @SqlCmd;
		EXECUTE Stmt;
		DEALLOCATE PREPARE Stmt;
	
		SIGNAL SQLSTATE '10001' SET MESSAGE_TEXT=@J_ERR_MSG;
	END IF;
