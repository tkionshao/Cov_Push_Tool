CREATE DEFINER=`covmo`@`%` PROCEDURE `SP_Sub_Generate_Pmc_Hourly_GSM`(IN GT_DB VARCHAR(100))
BEGIN
	DECLARE START_TIME DATETIME DEFAULT SYSDATE();
	DECLARE START_HH VARCHAR(2) DEFAULT LEFT(gt_strtok(GT_DB,4,'_'),2);
	DECLARE O_GT_DB VARCHAR(100) DEFAULT GT_DB;
	DECLARE SH_EH VARCHAR(9) DEFAULT RIGHT(GT_DB,9);
	DECLARE DY_GT_DB VARCHAR(100);	
	DECLARE START_DATE VARCHAR(10) DEFAULT CONCAT(LEFT(gt_strtok(GT_DB,3,'_'),4),'-',SUBSTRING(gt_strtok(GT_DB,3,'_'),5,2),'-',SUBSTRING(gt_strtok(GT_DB,3,'_'),7,2));
	DECLARE CURRENT_NT_DB VARCHAR(50) DEFAULT CONCAT('gt_nt_',DATE_FORMAT(START_DATE,'%Y%m%d'));
	DECLARE WORKER_ID VARCHAR(10) DEFAULT CONNECTION_ID();
	
	SELECT REPLACE(GT_DB,SH_EH,'0000_0000') INTO DY_GT_DB;
 
	INSERT INTO gt_gw_main.sp_log VALUES(O_GT_DB,'SP_Sub_Generate_Pmc_Hourly_GSM','Start ', NOW());
	SET @SqlCmd=CONCAT('TRUNCATE TABLE ',DY_GT_DB,'.`table_tile_pmc_gsm_c_',START_HH,'`;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	
	INSERT INTO gt_gw_main.sp_log VALUES(O_GT_DB,'SP_Sub_Generate_Pmc_Hourly_GSM',CONCAT('Insert into table tmp_table_call_gsm_',WORKER_ID), NOW());
	
	SET @SqlCmd=CONCAT('DROP TEMPORARY TABLE IF EXISTS  ',DY_GT_DB,'.tmp_table_call_gsm_',WORKER_ID,' ;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	
	SET @SqlCmd=CONCAT('CREATE TEMPORARY TABLE ',DY_GT_DB,'.`tmp_table_call_gsm_',WORKER_ID,'`  
									(	
										DATA_DATE DATE NOT NULL ,
										DATA_HOUR TINYINT(4) NOT NULL ,
										BSC_ID MEDIUMINT(9) NOT NULL ,
										CELL_ID MEDIUMINT(9) NOT NULL ,
										CELL_NAME VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_swedish_ci DEFAULT NULL,
										SDCCH_ATT MEDIUMINT(9) DEFAULT NULL,
										SDCCH_FAIL MEDIUMINT(9) DEFAULT NULL,
										TCH_ATT MEDIUMINT(9) DEFAULT NULL,
										TCH_FAIL MEDIUMINT(9) DEFAULT NULL,
										RE_ESTAB_ATT MEDIUMINT(9) DEFAULT NULL,
										RE_ESTAB_FAIL MEDIUMINT(9) DEFAULT NULL,
										PRIMARY KEY(DATA_DATE,DATA_HOUR,BSC_ID,CELL_ID)
									)	ENGINE=MYISAM;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	
	SET @SqlCmd=CONCAT('INSERT INTO ',DY_GT_DB,'.`tmp_table_call_gsm_',WORKER_ID,'`  
									(
										DATA_DATE,
										DATA_HOUR,
										BSC_ID,
										CELL_ID,
										CELL_NAME,
										SDCCH_ATT,
										SDCCH_FAIL,
										TCH_ATT,
										TCH_FAIL,
										RE_ESTAB_ATT,
										RE_ESTAB_FAIL
									)
									SELECT 
										DATA_DATE,
										DATA_HOUR,
										POS_FIRST_BSC AS BSC_ID,
										POS_FIRST_CELL AS CELL_ID,
										POS_FIRST_CELL_NAME AS CELL_NAME,
										SUM(IF(ACCESS_REASON !=1014000000 AND ACCESS_REASON IS NOT NULL, 1,0)) AS SDCCH_ATT,
										SUM(IF(ACCESS_REASON !=1014000000 AND ACCESS_REASON IS NOT NULL AND CALL_STATUS IN (3,6), 1,0)) AS SDCCH_FAIL,
										SUM(IF(ACCESS_REASON IN (1000000000,1002000000,1003000000,1004000000,1007000000,1048000000), 1,0)) AS TCH_ATT,
										SUM(IF(ACCESS_REASON IN (1000000000,1002000000,1003000000,1004000000,1007000000,1048000000) AND CALL_STATUS IN (3,6), 1,0)) AS TCH_FAIL,
										SUM(IF(ACCESS_REASON=1003000000, 1,0)) AS RE_ESTAB_ATT,
										SUM(IF(ACCESS_REASON=1003000000 AND CALL_STATUS IN (3,6), 1,0)) AS RE_ESTAB_FAIL
									FROM ',DY_GT_DB,'.table_call_gsm 
 									WHERE DATA_HOUR=',START_HH,' AND POS_FIRST_CELL IS NOT NULL
									GROUP BY DATA_DATE,DATA_HOUR,POS_FIRST_BSC,POS_FIRST_CELL;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;

	INSERT INTO gt_gw_main.sp_log VALUES(O_GT_DB,'SP_Sub_Generate_Pmc_Hourly_GSM',CONCAT('Insert into table table_tile_pmc_gsm_c_',START_HH), NOW());
	
	SET @SqlCmd=CONCAT('INSERT INTO ',DY_GT_DB,'.`table_tile_pmc_gsm_c_',START_HH,'` 
						SELECT 
							DATA_DATE																	,
							DATA_HOUR,
							BSC_ID,
							CELL_ID,
							CELL_LON,
							CELL_LAT,
							BANDINDEX,
							BCCH_ARFCN,
							CELL_NAME,							
							MAX(CALL_CNT) AS CALL_CNT,
							MAX(RXLEV_FULL_DOWNLINK_CNT) AS RXLEV_FULL_DOWNLINK_CNT,
							MAX(RXLEV_FULL_DOWNLINK_SUM) AS RXLEV_FULL_DOWNLINK_SUM,
							MAX(RXQUAL_FULL_DOWNLINK_CNT) AS RXQUAL_FULL_DOWNLINK_CNT,
							MAX(RXQUAL_FULL_DOWNLINK_SUM) AS RXQUAL_FULL_DOWNLINK_SUM,
							MAX(RXLEV_FULL_DOWNLINK_AVG) AS RXLEV_FULL_DOWNLINK_AVG,
							MAX(RXQUAL_FULL_DOWNLINK_AVG) AS RXQUAL_FULL_DOWNLINK_AVG,
							MAX(IMSI_CNT) AS IMSI_CNT,
							MAX(CALL_TYPE_10) AS CALL_TYPE_10,
							MAX(CALL_TYPE_16) AS CALL_TYPE_16,
							MAX(CALL_TYPE_20) AS CALL_TYPE_20,
							MAX(CALL_TYPE_99) AS CALL_TYPE_99,
							MAX(RXLEV_FULL_UPLINK_SUM) AS RXLEV_FULL_UPLINK_SUM,
							MAX(RXQUAL_FULL_UPLINK_SUM) AS RXQUAL_FULL_UPLINK_SUM,
							MAX(RXLEV_FULL_UPLINK_CNT) AS RXLEV_FULL_UPLINK_CNT,
							MAX(RXQUAL_FULL_UPLINK_CNT) AS RXQUAL_FULL_UPLINK_CNT,
							MAX(RXLEV_FULL_UPLINK_MED_AVG) AS RXLEV_FULL_UPLINK_MED_AVG,
							MAX(RXQUAL_FULL_UPLINK_MED_AVG) AS RXQUAL_FULL_UPLINK_MED_AVG,
							MAX(CALL_CNT_END) AS CALL_CNT_END,
							MAX(RXLEV_FULL_DOWNLINK_CNT_END) AS RXLEV_FULL_DOWNLINK_CNT_END,
							MAX(RXLEV_FULL_DOWNLINK_SUM_END) AS RXLEV_FULL_DOWNLINK_SUM_END,
							MAX(RXQUAL_FULL_DOWNLINK_CNT_END) AS RXQUAL_FULL_DOWNLINK_CNT_END,
							MAX(RXQUAL_FULL_DOWNLINK_SUM_END) AS RXQUAL_FULL_DOWNLINK_SUM_END,
							MAX(RXLEV_FULL_UPLINK_SUM_END) AS RXLEV_FULL_UPLINK_SUM_END,
							MAX(RXQUAL_FULL_UPLINK_SUM_END) AS RXQUAL_FULL_UPLINK_SUM_END,
							MAX(RXLEV_FULL_UPLINK_CNT_END) AS RXLEV_FULL_UPLINK_CNT_END,
							MAX(RXQUAL_FULL_UPLINK_CNT_END) AS RXQUAL_FULL_UPLINK_CNT_END,
							MAX(RXLEV_FULL_UPLINK_MED_AVG_END) AS RXLEV_FULL_UPLINK_MED_AVG_END,
							MAX(RXQUAL_FULL_UPLINK_MED_AVG_END) AS RXQUAL_FULL_UPLINK_MED_AVG_END,
							MAX(BSSMAP_11) AS BSSMAP_11,
							MAX(BSSMAP_12) AS BSSMAP_12,
							MAX(BSSMAP_13) AS BSSMAP_13,
							MAX(BSSMAP_14) AS BSSMAP_14,
							MAX(BSSMAP_15) AS BSSMAP_15,
							MAX(BSSMAP_16) AS BSSMAP_16,
							MAX(BSSMAP_17) AS BSSMAP_17,
							MAX(BSSMAP_18) AS BSSMAP_18,
							MAX(RSL_21) AS RSL_21,
							MAX(RSL_22) AS RSL_22,
							MAX(RSL_23) AS RSL_23,
							MAX(RR_31) AS RR_31,
							MAX(RR_32) AS RR_32,
							MAX(RR_33) AS RR_33,
							MAX(RR_34) AS RR_34,
							MAX(RR_35) AS RR_35,
							MAX(RR_36) AS RR_36,
							MAX(FP_RXLEV_BEST_SUM) AS FP_RXLEV_BEST_SUM,
							MAX(FP_RXQUAL_BEST_SUM) AS FP_RXQUAL_BEST_SUM,
							MAX(FP_RXLEV_BEST_MED_AVG) AS FP_RXLEV_BEST_MED_AVG,
							MAX(FP_RXQUAL_BEST_MED_AVG) AS FP_RXQUAL_BEST_MED_AVG,
							MAX(FP_RXLEV_ALL_SUM) AS FP_RXLEV_ALL_SUM,
							MAX(FP_RXQUAL_ALL_SUM) AS FP_RXQUAL_ALL_SUM,
							MAX(FP_RXLEV_ALL_MED_AVG) AS FP_RXLEV_ALL_MED_AVG,
							MAX(FP_RXQUAL_ALL_MED_AVG) AS FP_RXQUAL_ALL_MED_AVG,
							MAX(MMR_CNT) AS MMR_CNT,
							MAX(BEST_CNT) AS BEST_CNT,
							MAX(BEST_SERVING_CNT) AS BEST_SERVING_CNT,
							MAX(SERVING_CNT) AS SERVING_CNT,
							MAX(RXLEV_GAP_SUM) AS RXLEV_GAP_SUM,
							MAX(RXLEV_GAP_CNT) AS RXLEV_GAP_CNT,
							MAX(SERVING_RXLEV_BETTER_GAP_SUM) AS SERVING_RXLEV_BETTER_GAP_SUM,
							MAX(SERVING_RXLEV_BETTER_GAP_CNT) AS SERVING_RXLEV_BETTER_GAP_CNT,
							MAX(SERVING_RXLEV_WORSE_GAP_SUM) AS SERVING_RXLEV_WORSE_GAP_SUM,
							MAX(SERVING_RXLEV_WORSE_GAP_CNT) AS SERVING_RXLEV_WORSE_GAP_CNT,
							MAX(INTERFERED_CNT) AS INTERFERED_CNT,
							MAX(MS_POWER_SUM) AS MS_POWER_SUM,
							MAX(MS_POWER_CNT) AS MS_POWER_CNT,
							MAX(TOTAL_SERVING_CNT) AS TOTAL_SERVING_CNT,
							MAX(DURATION) AS DURATION,
							MAX(INTER_CELL_HO_CNT) AS INTER_CELL_HO_CNT,
							MAX(INTER_CELL_HO_FAIL_CNT) AS INTER_CELL_HO_FAIL_CNT,
							MAX(INTRA_CELL_HO_CNT) AS INTRA_CELL_HO_CNT,
							MAX(INTRA_CELL_HO_FAIL_CNT) AS INTRA_CELL_HO_FAIL_CNT,
							MAX(SDCCH_ATT) AS SDCCH_ATT,
							MAX(SDCCH_FAIL) AS SDCCH_FAIL,
							MAX(TCH_ATT) AS TCH_ATT,
							MAX(TCH_FAIL) AS TCH_FAIL,
							MAX(RE_ESTAB_ATT) AS RE_ESTAB_ATT,
							MAX(RE_ESTAB_FAIL) AS RE_ESTAB_FAIL
						FROM
						(
							SELECT 
								DATA_DATE,
								DATA_HOUR,
								BSC_ID,
								CELL_ID,
								CELL_LON,
								CELL_LAT,
								NULL AS BANDINDEX,
								NULL AS BCCH_ARFCN,
								CELL_NAME,
								NULL AS CALL_CNT,
								NULL AS RXLEV_FULL_DOWNLINK_CNT,
								NULL AS RXLEV_FULL_DOWNLINK_SUM,
								NULL AS RXQUAL_FULL_DOWNLINK_CNT,
								NULL AS RXQUAL_FULL_DOWNLINK_SUM,
								NULL AS RXLEV_FULL_DOWNLINK_AVG,
								NULL AS RXQUAL_FULL_DOWNLINK_AVG,
								NULL AS IMSI_CNT,
								NULL AS CALL_TYPE_10,
								NULL AS CALL_TYPE_16,
								NULL AS CALL_TYPE_20,
								NULL AS CALL_TYPE_99,
								NULL AS RXLEV_FULL_UPLINK_SUM,
								NULL AS RXQUAL_FULL_UPLINK_SUM,
								NULL AS RXLEV_FULL_UPLINK_CNT,
								NULL AS RXQUAL_FULL_UPLINK_CNT,
								NULL AS RXLEV_FULL_UPLINK_MED_AVG,
								NULL AS RXQUAL_FULL_UPLINK_MED_AVG,
								NULL AS CALL_CNT_END,
								NULL AS RXLEV_FULL_DOWNLINK_CNT_END,
								NULL AS RXLEV_FULL_DOWNLINK_SUM_END,
								NULL AS RXQUAL_FULL_DOWNLINK_CNT_END,
								NULL AS RXQUAL_FULL_DOWNLINK_SUM_END,
								NULL AS RXLEV_FULL_UPLINK_SUM_END,
								NULL AS RXQUAL_FULL_UPLINK_SUM_END,
								NULL AS RXLEV_FULL_UPLINK_CNT_END,
								NULL AS RXQUAL_FULL_UPLINK_CNT_END,
								NULL AS RXLEV_FULL_UPLINK_MED_AVG_END,
								NULL AS RXQUAL_FULL_UPLINK_MED_AVG_END,
								NULL AS BSSMAP_11,
								NULL AS BSSMAP_12,
								NULL AS BSSMAP_13,
								NULL AS BSSMAP_14,
								NULL AS BSSMAP_15,
								NULL AS BSSMAP_16,
								NULL AS BSSMAP_17,
								NULL AS BSSMAP_18,
								NULL AS RSL_21,
								NULL AS RSL_22,
								NULL AS RSL_23,
								NULL AS RR_31,
								NULL AS RR_32,
								NULL AS RR_33,
								NULL AS RR_34,
								NULL AS RR_35,
								NULL AS RR_36,
								FP_RXLEV_BEST_SUM AS FP_RXLEV_BEST_SUM,
								FP_RXQUAL_BEST_SUM AS FP_RXQUAL_BEST_SUM,
								FP_RXLEV_BEST_MED_AVG AS FP_RXLEV_BEST_MED_AVG,
								FP_RXQUAL_BEST_MED_AVG AS FP_RXQUAL_BEST_MED_AVG,
								FP_RXLEV_ALL_SUM AS FP_RXLEV_ALL_SUM,
								FP_RXQUAL_ALL_SUM AS FP_RXQUAL_ALL_SUM,
								FP_RXLEV_ALL_MED_AVG AS FP_RXLEV_ALL_MED_AVG,
								FP_RXQUAL_ALL_MED_AVG AS FP_RXQUAL_ALL_MED_AVG,
								MMR_CNT AS MMR_CNT,
								BEST_CNT AS BEST_CNT,
								BEST_SERVING_CNT AS BEST_SERVING_CNT,
								SERVING_CNT AS SERVING_CNT,
								RXLEV_GAP_SUM AS RXLEV_GAP_SUM,
								RXLEV_GAP_CNT AS RXLEV_GAP_CNT,
								SERVING_RXLEV_BETTER_GAP_SUM AS SERVING_RXLEV_BETTER_GAP_SUM,
								SERVING_RXLEV_BETTER_GAP_CNT AS SERVING_RXLEV_BETTER_GAP_CNT,
								SERVING_RXLEV_WORSE_GAP_SUM AS SERVING_RXLEV_WORSE_GAP_SUM,
								SERVING_RXLEV_WORSE_GAP_CNT AS SERVING_RXLEV_WORSE_GAP_CNT,
								INTERFERED_CNT AS INTERFERED_CNT,
								MS_POWER_SUM AS MS_POWER_SUM,
								MS_POWER_CNT AS MS_POWER_CNT,
								TOTAL_SERVING_CNT AS TOTAL_SERVING_CNT,
								DURATION AS DURATION,
								INTER_CELL_HO_CNT AS INTER_CELL_HO_CNT,
								INTER_CELL_HO_FAIL_CNT AS INTER_CELL_HO_FAIL_CNT,
								INTRA_CELL_HO_CNT AS INTRA_CELL_HO_CNT,
								INTRA_CELL_HO_FAIL_CNT AS INTRA_CELL_HO_FAIL_CNT,
								NULL AS SDCCH_ATT,
								NULL AS SDCCH_FAIL,
								NULL AS TCH_ATT,
								NULL AS TCH_FAIL,
								NULL AS RE_ESTAB_ATT,
								NULL AS RE_ESTAB_FAIL
							FROM `',DY_GT_DB,'`.table_tile_fp_gsm_c_def WHERE DATA_HOUR=',START_HH,'
							UNION ALL
							SELECT 
								DATA_DATE,
								DATA_HOUR,
								BSC_ID,
								CELL_ID,
								CELL_LON,
								CELL_LAT,
								NULL AS BANDINDEX,
								NULL AS BCCH_ARFCN,
								CELL_NAME,
								CALL_CNT AS CALL_CNT,
								RXLEV_FULL_DOWNLINK_CNT AS RXLEV_FULL_DOWNLINK_CNT,
								RXLEV_FULL_DOWNLINK_SUM AS RXLEV_FULL_DOWNLINK_SUM,
								RXQUAL_FULL_DOWNLINK_CNT AS RXQUAL_FULL_DOWNLINK_CNT,
								RXQUAL_FULL_DOWNLINK_SUM AS RXQUAL_FULL_DOWNLINK_SUM,
								RXLEV_FULL_DOWNLINK_AVG AS RXLEV_FULL_DOWNLINK_AVG,
								RXQUAL_FULL_DOWNLINK_AVG AS RXQUAL_FULL_DOWNLINK_AVG,
								IMSI_CNT AS IMSI_CNT,
								CALL_TYPE_10 AS CALL_TYPE_10,
								CALL_TYPE_16 AS CALL_TYPE_16,
								CALL_TYPE_20 AS CALL_TYPE_20,
								CALL_TYPE_99 AS CALL_TYPE_99,
								RXLEV_FULL_UPLINK_SUM AS RXLEV_FULL_UPLINK_SUM,
								RXQUAL_FULL_UPLINK_SUM AS RXQUAL_FULL_UPLINK_SUM,
								RXLEV_FULL_UPLINK_CNT AS RXLEV_FULL_UPLINK_CNT,
								RXQUAL_FULL_UPLINK_CNT AS RXQUAL_FULL_UPLINK_CNT,
								RXLEV_FULL_UPLINK_MED_AVG AS RXLEV_FULL_UPLINK_MED_AVG,
								RXQUAL_FULL_UPLINK_MED_AVG AS RXQUAL_FULL_UPLINK_MED_AVG,
								NULL AS CALL_CNT_END,
								NULL AS RXLEV_FULL_DOWNLINK_CNT_END,
								NULL AS RXLEV_FULL_DOWNLINK_SUM_END,
								NULL AS RXQUAL_FULL_DOWNLINK_CNT_END,
								NULL AS RXQUAL_FULL_DOWNLINK_SUM_END,
								NULL AS RXLEV_FULL_UPLINK_SUM_END,
								NULL AS RXQUAL_FULL_UPLINK_SUM_END,
								NULL AS RXLEV_FULL_UPLINK_CNT_END,
								NULL AS RXQUAL_FULL_UPLINK_CNT_END,
								NULL AS RXLEV_FULL_UPLINK_MED_AVG_END,
								NULL AS RXQUAL_FULL_UPLINK_MED_AVG_END,
								NULL AS BSSMAP_11,
								NULL AS BSSMAP_12,
								NULL AS BSSMAP_13,
								NULL AS BSSMAP_14,
								NULL AS BSSMAP_15,
								NULL AS BSSMAP_16,
								NULL AS BSSMAP_17,
								NULL AS BSSMAP_18,
								NULL AS RSL_21,
								NULL AS RSL_22,
								NULL AS RSL_23,
								NULL AS RR_31,
								NULL AS RR_32,
								NULL AS RR_33,
								NULL AS RR_34,
								NULL AS RR_35,
								NULL AS RR_36,
								NULL AS FP_RXLEV_BEST_SUM,
								NULL AS FP_RXQUAL_BEST_SUM,
								NULL AS FP_RXLEV_BEST_MED_AVG,
								NULL AS FP_RXQUAL_BEST_MED_AVG,
								NULL AS FP_RXLEV_ALL_SUM,
								NULL AS FP_RXQUAL_ALL_SUM,
								NULL AS FP_RXLEV_ALL_MED_AVG,
								NULL AS FP_RXQUAL_ALL_MED_AVG,
								NULL AS MMR_CNT,
								NULL AS BEST_CNT,
								NULL AS BEST_SERVING_CNT,
								NULL AS SERVING_CNT,
								NULL AS RXLEV_GAP_SUM,
								NULL AS RXLEV_GAP_CNT,
								NULL AS SERVING_RXLEV_BETTER_GAP_SUM,
								NULL AS SERVING_RXLEV_BETTER_GAP_CNT,
								NULL AS SERVING_RXLEV_WORSE_GAP_SUM,
								NULL AS SERVING_RXLEV_WORSE_GAP_CNT,
								NULL AS INTERFERED_CNT,
								NULL AS MS_POWER_SUM,
								NULL AS MS_POWER_CNT,
								NULL AS TOTAL_SERVING_CNT,
								NULL AS DURATION,
								NULL AS INTER_CELL_HO_CNT,
								NULL AS INTER_CELL_HO_FAIL_CNT,
								NULL AS INTRA_CELL_HO_CNT,
								NULL AS INTRA_CELL_HO_FAIL_CNT,
								NULL AS SDCCH_ATT,
								NULL AS SDCCH_FAIL,
								NULL AS TCH_ATT,
								NULL AS TCH_FAIL,
								NULL AS RE_ESTAB_ATT,
								NULL AS RE_ESTAB_FAIL
							FROM `',DY_GT_DB,'`.table_tile_start_gsm_c_def WHERE DATA_HOUR=',START_HH,'
							UNION ALL
							SELECT 
								DATA_DATE,
								DATA_HOUR,
								BSC_ID,
								CELL_ID,
								CELL_LON,
								CELL_LAT,
								NULL AS BANDINDEX,
								NULL AS BCCH_ARFCN,
								CELL_NAME,
								NULL AS CALL_CNT,
								NULL AS RXLEV_FULL_DOWNLINK_CNT,
								NULL AS RXLEV_FULL_DOWNLINK_SUM,
								NULL AS RXQUAL_FULL_DOWNLINK_CNT,
								NULL AS RXQUAL_FULL_DOWNLINK_SUM,
								NULL AS RXLEV_FULL_DOWNLINK_AVG,
								NULL AS RXQUAL_FULL_DOWNLINK_AVG,
								NULL AS IMSI_CNT,
								NULL AS CALL_TYPE_10,
								NULL AS CALL_TYPE_16,
								NULL AS CALL_TYPE_20,
								NULL AS CALL_TYPE_99,
								NULL AS RXLEV_FULL_UPLINK_SUM,
								NULL AS RXQUAL_FULL_UPLINK_SUM,
								NULL AS RXLEV_FULL_UPLINK_CNT,
								NULL AS RXQUAL_FULL_UPLINK_CNT,
								NULL AS RXLEV_FULL_UPLINK_MED_AVG,
								NULL AS RXQUAL_FULL_UPLINK_MED_AVG,
								CALL_CNT AS CALL_CNT_END,
								RXLEV_FULL_DOWNLINK_CNT AS RXLEV_FULL_DOWNLINK_CNT_END,
								RXLEV_FULL_DOWNLINK_SUM AS RXLEV_FULL_DOWNLINK_SUM_END,
								RXQUAL_FULL_DOWNLINK_CNT AS RXQUAL_FULL_DOWNLINK_CNT_END,
								RXQUAL_FULL_DOWNLINK_SUM AS RXQUAL_FULL_DOWNLINK_SUM_END,
								RXLEV_FULL_UPLINK_SUM AS RXLEV_FULL_UPLINK_SUM_END,
								RXQUAL_FULL_UPLINK_SUM AS RXQUAL_FULL_UPLINK_SUM_END,
								RXLEV_FULL_UPLINK_CNT AS RXLEV_FULL_UPLINK_CNT_END,
								RXQUAL_FULL_UPLINK_CNT AS RXQUAL_FULL_UPLINK_CNT_END,
								RXLEV_FULL_UPLINK_MED_AVG AS RXLEV_FULL_UPLINK_MED_AVG_END,
								RXQUAL_FULL_UPLINK_MED_AVG AS RXQUAL_FULL_UPLINK_MED_AVG_END,
								BSSMAP_11 AS BSSMAP_11,
								BSSMAP_12 AS BSSMAP_12,
								BSSMAP_13 AS BSSMAP_13,
								BSSMAP_14 AS BSSMAP_14,
								BSSMAP_15 AS BSSMAP_15,
								BSSMAP_16 AS BSSMAP_16,
								BSSMAP_17 AS BSSMAP_17,
								BSSMAP_18 AS BSSMAP_18,
								RSL_21 AS RSL_21,
								RSL_22 AS RSL_22,
								RSL_23 AS RSL_23,
								RR_31 AS RR_31,
								RR_32 AS RR_32,
								RR_33 AS RR_33,
								RR_34 AS RR_34,
								RR_35 AS RR_35,
								RR_36 AS RR_36,
								NULL AS FP_RXLEV_BEST_SUM,
								NULL AS FP_RXQUAL_BEST_SUM,
								NULL AS FP_RXLEV_BEST_MED_AVG,
								NULL AS FP_RXQUAL_BEST_MED_AVG,
								NULL AS FP_RXLEV_ALL_SUM,
								NULL AS FP_RXQUAL_ALL_SUM,
								NULL AS FP_RXLEV_ALL_MED_AVG,
								NULL AS FP_RXQUAL_ALL_MED_AVG,
								NULL AS MMR_CNT,
								NULL AS BEST_CNT,
								NULL AS BEST_SERVING_CNT,
								NULL AS SERVING_CNT,
								NULL AS RXLEV_GAP_SUM,
								NULL AS RXLEV_GAP_CNT,
								NULL AS SERVING_RXLEV_BETTER_GAP_SUM,
								NULL AS SERVING_RXLEV_BETTER_GAP_CNT,
								NULL AS SERVING_RXLEV_WORSE_GAP_SUM,
								NULL AS SERVING_RXLEV_WORSE_GAP_CNT,
								NULL AS INTERFERED_CNT,
								NULL AS MS_POWER_SUM,
								NULL AS MS_POWER_CNT,
								NULL AS TOTAL_SERVING_CNT,
								NULL AS DURATION,
								NULL AS INTER_CELL_HO_CNT,
								NULL AS INTER_CELL_HO_FAIL_CNT,
								NULL AS INTRA_CELL_HO_CNT,
								NULL AS INTRA_CELL_HO_FAIL_CNT,
								NULL AS SDCCH_ATT,
								NULL AS SDCCH_FAIL,
								NULL AS TCH_ATT,
								NULL AS TCH_FAIL,
								NULL AS RE_ESTAB_ATT,
								NULL AS RE_ESTAB_FAIL
							FROM `',DY_GT_DB,'`.table_tile_end_gsm_c_def WHERE DATA_HOUR=',START_HH,'
							UNION ALL
							SELECT 
								DATA_DATE,
								DATA_HOUR,
								BSC_ID,
								CELL_ID,
								NULL AS CELL_LON,
								NULL AS CELL_LAT,
								NULL AS BANDINDEX,
								NULL AS BCCH_ARFCN,
								CELL_NAME,
								NULL AS CALL_CNT,
								NULL AS RXLEV_FULL_DOWNLINK_CNT,
								NULL AS RXLEV_FULL_DOWNLINK_SUM,
								NULL AS RXQUAL_FULL_DOWNLINK_CNT,
								NULL AS RXQUAL_FULL_DOWNLINK_SUM,
								NULL AS RXLEV_FULL_DOWNLINK_AVG,
								NULL AS RXQUAL_FULL_DOWNLINK_AVG,
								NULL AS IMSI_CNT,
								NULL AS CALL_TYPE_10,
								NULL AS CALL_TYPE_16,
								NULL AS CALL_TYPE_20,
								NULL AS CALL_TYPE_99,
								NULL AS RXLEV_FULL_UPLINK_SUM,
								NULL AS RXQUAL_FULL_UPLINK_SUM,
								NULL AS RXLEV_FULL_UPLINK_CNT,
								NULL AS RXQUAL_FULL_UPLINK_CNT,
								NULL AS RXLEV_FULL_UPLINK_MED_AVG,
								NULL AS RXQUAL_FULL_UPLINK_MED_AVG,
								NULL AS CALL_CNT_END,
								NULL AS RXLEV_FULL_DOWNLINK_CNT_END,
								NULL AS RXLEV_FULL_DOWNLINK_SUM_END,
								NULL AS RXQUAL_FULL_DOWNLINK_CNT_END,
								NULL AS RXQUAL_FULL_DOWNLINK_SUM_END,
								NULL AS RXLEV_FULL_UPLINK_SUM_END,
								NULL AS RXQUAL_FULL_UPLINK_SUM_END,
								NULL AS RXLEV_FULL_UPLINK_CNT_END,
								NULL AS RXQUAL_FULL_UPLINK_CNT_END,
								NULL AS RXLEV_FULL_UPLINK_MED_AVG_END,
								NULL AS RXQUAL_FULL_UPLINK_MED_AVG_END,
								NULL AS BSSMAP_11,
								NULL AS BSSMAP_12,
								NULL AS BSSMAP_13,
								NULL AS BSSMAP_14,
								NULL AS BSSMAP_15,
								NULL AS BSSMAP_16,
								NULL AS BSSMAP_17,
								NULL AS BSSMAP_18,
								NULL AS RSL_21,
								NULL AS RSL_22,
								NULL AS RSL_23,
								NULL AS RR_31,
								NULL AS RR_32,
								NULL AS RR_33,
								NULL AS RR_34,
								NULL AS RR_35,
								NULL AS RR_36,
								NULL AS FP_RXLEV_BEST_SUM,
								NULL AS FP_RXQUAL_BEST_SUM,
								NULL AS FP_RXLEV_BEST_MED_AVG,
								NULL AS FP_RXQUAL_BEST_MED_AVG,
								NULL AS FP_RXLEV_ALL_SUM,
								NULL AS FP_RXQUAL_ALL_SUM,
								NULL AS FP_RXLEV_ALL_MED_AVG,
								NULL AS FP_RXQUAL_ALL_MED_AVG,
								NULL AS MMR_CNT,
								NULL AS BEST_CNT,
								NULL AS BEST_SERVING_CNT,
								NULL AS SERVING_CNT,
								NULL AS RXLEV_GAP_SUM,
								NULL AS RXLEV_GAP_CNT,
								NULL AS SERVING_RXLEV_BETTER_GAP_SUM,
								NULL AS SERVING_RXLEV_BETTER_GAP_CNT,
								NULL AS SERVING_RXLEV_WORSE_GAP_SUM,
								NULL AS SERVING_RXLEV_WORSE_GAP_CNT,
								NULL AS INTERFERED_CNT,
								NULL AS MS_POWER_SUM,
								NULL AS MS_POWER_CNT,
								NULL AS TOTAL_SERVING_CNT,
								NULL AS DURATION,
								NULL AS INTER_CELL_HO_CNT,
								NULL AS INTER_CELL_HO_FAIL_CNT,
								NULL AS INTRA_CELL_HO_CNT,
								NULL AS INTRA_CELL_HO_FAIL_CNT,
								SDCCH_ATT AS SDCCH_ATT,
								SDCCH_FAIL AS SDCCH_FAIL,
								TCH_ATT AS TCH_ATT,
								TCH_FAIL AS TCH_FAIL,
								RE_ESTAB_ATT AS RE_ESTAB_ATT,
								RE_ESTAB_FAIL AS RE_ESTAB_FAIL
							FROM ',DY_GT_DB,'.tmp_table_call_gsm_',WORKER_ID,' 
						) AA
						GROUP BY DATA_DATE,DATA_HOUR,BSC_ID,CELL_ID;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;
	
	SET @SqlCmd=CONCAT('UPDATE ',DY_GT_DB,'.table_tile_pmc_gsm_c_',START_HH,' a,',CURRENT_NT_DB,'.nt_cell_current_gsm B
				SET A.CELL_LON=B.LONGITUDE,
						A.CELL_LAT=B.LATITUDE,
						A.BANDINDEX=B.BANDINDEX,
						A.BCCH_ARFCN=B.BCCH_ARFCN
				WHERE A.BSC_ID=B.BSC_ID AND A.CELL_ID=B.CELL_ID;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;	
	
	SET @SqlCmd=CONCAT('DROP TEMPORARY TABLE IF EXISTS  ',DY_GT_DB,'.tmp_table_call_gsm_',WORKER_ID,' ;');
	PREPARE Stmt FROM @SqlCmd;
	EXECUTE Stmt;
	DEALLOCATE PREPARE Stmt;	
	
	INSERT INTO gt_gw_main.SP_LOG VALUES(O_GT_DB,'SP_Sub_Generate_Pmc_Hourly_GSM',CONCAT('Done: ',TIMESTAMPDIFF(SECOND,START_TIME,SYSDATE()),' seconds.'), NOW());	
END
utf8
utf8_general_ci
latin1_swedish_ci
